<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>TypeSpark | 16å‹å­¦ç”Ÿç‰ˆï¼ˆ20é¢˜ï¼‰</title>
<meta name="description" content="TypeSpark å­¦ç”Ÿç‰ˆï¼š20é¢˜è½»é‡æµ‹è¯„ï¼Œç»“æœå«ç±»å‹ã€å­—æ¯è§£é‡Šï¼ˆå¤§å­—æ¯+è‹±æ–‡+ä¸­æ–‡ï¼‰ã€ç»´åº¦å¼ºåº¦ã€ä»£è¡¨äººç‰©ï¼ˆå«å£å¤´ç¦…ï¼‰ä¸å­¦ä¹ å»ºè®®ï¼›æ´»æ³¼åŠ¨ç”»é£æ ¼ï¼›æ”¯æŒèƒŒæ™¯éŸ³ä¹ã€‚ç”± Hannah åˆ¶ä½œã€‚" />
<style>
  :root{
    --c-blue:#4DA3FF;
    --c-purple:#8B77FF;
    --c-orange:#FFB84D;
    --c-green:#66E3A4;
    --c-pink:#FF6B9A;
    --c-bg1:#f6f8ff;
    --c-bg2:#fefaf5;
    --c-text:#2f2f33;
    --c-muted:#6b6f76;
    --c-card:#ffffff;
    --radius:16px;
    --shadow:0 6px 20px rgba(0,0,0,0.08);
    --shadow-soft:0 3px 12px rgba(0,0,0,0.06);
    --bar-h:12px;
    --trans:220ms cubic-bezier(.2,.8,.2,1);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --c-bg1:#0f1220; --c-bg2:#191d2d; --c-text:#f2f4fa; --c-muted:#a7abc0; --c-card:#141826;
      --shadow:0 6px 20px rgba(0,0,0,.35); --shadow-soft:0 3px 12px rgba(0,0,0,.28);
    }
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    color:var(--c-text);
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(77,163,255,.20), transparent 60%),
      radial-gradient(900px 600px at 120% 10%, rgba(139,119,255,.18), transparent 55%),
      radial-gradient(700px 500px at 50% 120%, rgba(255,184,77,.18), transparent 50%),
      linear-gradient(180deg,var(--c-bg1),var(--c-bg2));
  }
  .wrap{max-width:980px; margin:0 auto; padding:16px 14px 80px}
  header{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(1.2) blur(8px);
    background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.5));
    border-bottom:1px solid rgba(0,0,0,.06);
  }
  @media (prefers-color-scheme: dark){
    header{ background:linear-gradient(180deg,rgba(20,24,38,.6),rgba(20,24,38,.35)); border-color:rgba(255,255,255,.08);}
  }
  .h-inner{max-width:980px; margin:0 auto; padding:10px 14px; display:flex; gap:10px; align-items:center; justify-content:space-between}
  .brand{display:flex; align-items:center; gap:10px;}
  .logo{
    width:36px; height:36px; border-radius:10px;
    background: conic-gradient(from 220deg, var(--c-blue), var(--c-purple), var(--c-orange), var(--c-green), var(--c-blue));
    box-shadow: var(--shadow-soft); position:relative; overflow:hidden;
  }
  .logo::after{content:"âœ¨"; position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:20px; filter:saturate(1.2)}
  .title{font-weight:800; letter-spacing:.3px}
  .subtitle{font-size:12px; color:var(--c-muted)}
  .tools{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .btn, button{
    appearance:none; border:none; cursor:pointer; border-radius:12px; padding:10px 14px; font-weight:600;
    color:#fff; background:linear-gradient(180deg,var(--c-blue),#328ef0);
    box-shadow: var(--shadow); transition: transform var(--trans), box-shadow var(--trans), opacity var(--trans);
  }
  .btn.secondary{ background:linear-gradient(180deg,#8b77ff,#6c59f0); }
  .btn.ghost{ background:transparent; color:var(--c-text); border:1px solid rgba(0,0,0,.12); box-shadow:none; }
  @media (prefers-color-scheme: dark){
    .btn.ghost{border-color:rgba(255,255,255,.16); color:#e9ecff;}
  }
  .btn:active{transform:translateY(1px)}
  .card{
    background:var(--c-card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin:14px 0;
  }
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid.cols-2{ grid-template-columns:1fr 1fr; } }
  .field{display:flex; flex-direction:column; gap:8px}
  .field.inline{flex-direction:row; align-items:center; gap:10px; flex-wrap:wrap}
  label{font-weight:600}
  input[type="text"]{
    padding:12px 12px; border-radius:12px; border:1px solid rgba(0,0,0,.12); background:transparent; color:var(--c-text);
    outline:none; transition:border-color var(--trans), box-shadow var(--trans);
  }
  input[type="text"]:focus{border-color:var(--c-blue); box-shadow:0 0 0 3px rgba(77,163,255,.18)}
  .muted{color:var(--c-muted); font-size:13px}
  .progress{height:10px; background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden}
  .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--c-green),var(--c-blue)); transition:width 240ms ease}
  .q-card{display:flex; flex-direction:column; gap:10px}
  .scale{display:flex; gap:6px; flex-wrap:wrap}
  .chip{
    padding:8px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.12);
    background:rgba(255,255,255,.6); color:var(--c-text); cursor:pointer; user-select:none;
    transition:all var(--trans);
    min-width: 44px; text-align:center;
  }
  .chip[data-active="true"]{ background:linear-gradient(180deg,var(--c-orange),#ff9800); color:#fff; border-color:transparent; box-shadow:var(--shadow-soft) }
  .k{font-weight:700; padding:4px 8px; border-radius:8px; background:rgba(0,0,0,.06)}
  .sep{height:1px; background:rgba(0,0,0,.08); margin:10px 0}
  .result-type{font-size:34px; font-weight:900; letter-spacing:2px}
  .badges{display:flex; gap:8px; flex-wrap:wrap}
  .tag{font-size:12px; padding:6px 8px; border-radius:999px; background:rgba(0,0,0,.06)}
  footer{
    position:fixed; bottom:0; left:0; right:0; background:linear-gradient(180deg,rgba(255,255,255,.2),rgba(255,255,255,.8));
    border-top:1px solid rgba(0,0,0,.06);
    backdrop-filter:saturate(1.2) blur(8px);
  }
  @media (prefers-color-scheme: dark){
    footer{ background:linear-gradient(180deg,rgba(20,24,38,.2),rgba(20,24,38,.8)); border-color:rgba(255,255,255,.08);}
  }
  .f-inner{max-width:980px; margin:0 auto; padding:10px 14px; display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
  .disclaimer{font-size:12px; color:var(--c-muted)}
  .sign{font-weight:700}
  .hidden{display:none !important}
  .center{display:flex; justify-content:center; align-items:center}
  .flex{display:flex}
  .gap8{gap:8px}
  .gap12{gap:12px}
  .gap16{gap:16px}
  .right{margin-left:auto}
  .pill{padding:6px 10px; border-radius:999px; background:rgba(0,0,0,.06); font-size:12px; display:flex; align-items:center; gap:6px}
  .note{font-size:12px; color:var(--c-muted)}
  .toast{
    position:fixed; left:50%; transform:translateX(-50%) translateY(20px);
    bottom:80px; background:#222; color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none;
    transition: all .3s ease; z-index:60; max-width:90%; text-align:center; box-shadow:var(--shadow);
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
  #confetti{position:fixed; inset:0; pointer-events:none; z-index:40}
  .reduce-motion *{ transition-duration:0ms !important; animation: none !important }

  /* Hero */
  .hero{
    position:relative; overflow:hidden; border-radius:18px;
    background: radial-gradient(600px 240px at 0% 0%, rgba(77,163,255,.25), transparent 60%),
                radial-gradient(600px 240px at 100% 0%, rgba(255,184,77,.25), transparent 60%),
                linear-gradient(180deg, #fff, #f8faff);
    padding:14px;
  }
  .hero .emoji{ font-size:48px; margin-right:8px; filter:saturate(1.1) }

  /* Section blocks */
  .section{border-radius:16px; padding:14px; background:var(--c-card); box-shadow:var(--shadow); margin:14px 0}
  .section .head{display:flex; align-items:center; gap:8px; font-weight:800; margin-bottom:10px}
  .head .h-emoji{font-size:22px}

  /* Axis cards */
  .axis-grid{display:grid; gap:12px}
  @media(min-width:700px){ .axis-grid{grid-template-columns:1fr 1fr; } }
  .axis-card{
    padding:12px; border-radius:12px; background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02));
    border:1px solid rgba(0,0,0,.06);
    box-shadow:var(--shadow-soft); position:relative; overflow:hidden;
  }
  .axis-title{display:flex; align-items:center; gap:8px; font-weight:700}
  .axis-title .a-emoji{font-size:20px}
  .bar{position:relative; height:var(--bar-h); background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden; margin-top:8px}
  .bar>i{position:absolute; inset:0; width:0%; border-radius:999px; background:linear-gradient(90deg,#8B77FF,#4DA3FF); }
  .shimmer{background:linear-gradient(90deg, rgba(255,255,255,.0), rgba(255,255,255,.35), rgba(255,255,255,.0));
           background-size:200% 100%; mix-blend-mode:soft-light; animation:shimmer 1.8s linear infinite;}
  @keyframes shimmer{ 0%{background-position:-200% 0;} 100%{background-position:200% 0;} }

  /* Letter meaning cards */
  .letters-grid{display:grid; gap:10px}
  @media(min-width:700px){ .letters-grid{grid-template-columns:1fr 1fr} }
  .letter-card{
    display:flex; gap:12px; align-items:center;
    border-radius:999px; padding:10px 12px;
    background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02));
    border:1px solid rgba(0,0,0,.06);
    box-shadow:var(--shadow-soft);
  }
  .big-letter{
    width:46px; height:46px; border-radius:50%; color:#fff; font-weight:900; font-size:26px;
    display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow-soft); flex:0 0 auto;
  }
  .lt-title{font-weight:800}
  .lt-desc{color:var(--c-muted); font-size:14px}

  /* Rep cards */
  .rep-grid{display:grid; gap:10px}
  @media(min-width:700px){ .rep-grid{grid-template-columns:1fr 1fr} }
  .rep-card{
    background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02)); border-radius:14px; padding:12px; border:1px solid rgba(0,0,0,.06);
    transition: transform 240ms ease, box-shadow 240ms ease;
  }
  .rep-card:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.08) }
  .rep-title{font-weight:700; display:flex; align-items:center; gap:6px}
  .rep-emoji{font-size:18px}
  .rep-quote{font-style:italic; color:var(--c-muted); margin-top:4px}

  /* Pop-in animation */
  .pop{opacity:0; transform:translateY(8px); animation:pop .5s ease forwards}
  .pop.delay1{animation-delay:.05s}
  .pop.delay2{animation-delay:.1s}
  .pop.delay3{animation-delay:.15s}
  .pop.delay4{animation-delay:.2s}
  @keyframes pop{ to{opacity:1; transform:translateY(0)}}

  /* Music controls */
  input[type="range"]{ accent-color:#6c59f0; }
  .range{width:90px; height:28px}
  audio{ display:none } /* éšè—åŸç”Ÿæ§ä»¶ */
</style>
</head>
<body>
<header>
  <div class="h-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title" data-i18n="appTitle">TypeSpark MBTIå­¦ç”Ÿç‰ˆ</div>
        <div class="subtitle" data-i18n="appSubtitle">5â€“6åˆ†é’Ÿå®Œæˆï½œç¦»çº¿å¯ç”¨ï½œä¸ç”¨äºè¯Šæ–­</div>
      </div>
    </div>
    <div class="tools">
      <div class="pill" role="group" aria-label="è¯­è¨€ Language">
        <button class="btn ghost" id="lang-zh">ä¸­</button>
        <button class="btn ghost" id="lang-en">EN</button>
      </div>
      <div class="pill">
        <span data-i18n="motion">åŠ¨æ•ˆ</span>ï¼š
        <button class="btn ghost" id="motion-standard" aria-pressed="true" data-i18n="motionStandard">æ ‡å‡†</button>
        <button class="btn ghost" id="motion-reduced" data-i18n="motionReduced">å¼±åŠ¨æ•ˆ</button>
      </div>
      <div class="pill" id="music-pill" role="group" aria-label="èƒŒæ™¯éŸ³ä¹">
        <span id="music-label">ğŸµ éŸ³ä¹</span>ï¼š
        <button class="btn ghost" id="music-toggle">å¼€å¯</button>
        <span id="music-vol-label">éŸ³é‡</span>
        <input id="music-vol" class="range" type="range" min="0" max="100" value="20" />
      </div>
    </div>
  </div>
</header>

<!-- èƒŒæ™¯éŸ³ä¹ï¼šä½¿ç”¨ä½ æä¾›çš„ mp3 -->
<audio id="bgm-audio" preload="metadata" loop
  src="https://pfst.cf2.poecdn.net/base/audio/6ea57e7f519a82251db529eb0e29c8948110a73d979b01a6e830442775af8555"></audio>

<canvas id="confetti" class="hidden"></canvas>

<div class="wrap" id="app">
  <!-- Intro -->
  <section id="intro" class="card">
    <h2 style="margin:0 0 6px" data-i18n="welcomeTitle">æ¬¢è¿ï¼å…ˆå¡«å†™ä¿¡æ¯åå¼€å§‹</h2>
    <p class="muted" data-i18n="welcomeTip">è¯´æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè¯¾å ‚äº¤æµä¸è‡ªæˆ‘äº†è§£ï¼Œéè¯Šæ–­ã€‚å§“åä¸ç­çº§ä»…ç”¨äºç»“æœå±•ç¤ºã€‚</p>
    <div class="grid cols-2">
      <div class="field">
        <label for="inp-name" data-i18n="name">å§“å</label>
        <input id="inp-name" type="text" placeholder="ä¾‹å¦‚ï¼šå¼ åŒå­¦" autocomplete="name" />
      </div>
      <div class="field">
        <label for="inp-class" data-i18n="class">ç­çº§</label>
        <input id="inp-class" type="text" placeholder="ä¾‹å¦‚ï¼šåˆä¸‰ï¼ˆ2ï¼‰ç­ / é«˜ä¸€ï¼ˆ5ï¼‰ç­" />
      </div>
    </div>
    <div class="field inline">
      <button class="btn" id="btn-start" data-i18n="start">å¼€å§‹ç­”é¢˜ â–¶</button>
    </div>
    <div class="sep"></div>
    <div class="disclaimer" data-i18n="disclaimerLong">
      å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚
    </div>
  </section>

  <!-- Questions -->
  <section id="quiz" class="card hidden" aria-live="polite">
    <div class="field">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <div><strong data-i18n="answerAll">è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®</strong></div>
        <div class="muted"><span id="count-ans">0</span>/20</div>
      </div>
      <div class="progress" aria-hidden="true"><i id="progress"></i></div>
    </div>
    <div id="q-list" class="grid"></div>
    <div class="field inline">
      <button class="btn" id="btn-submit" data-i18n="submit">æäº¤å¹¶æŸ¥çœ‹ç»“æœ ğŸ‰</button>
      <button class="btn ghost" id="btn-scrollTop" data-i18n="scrollTop">å›åˆ°é¡¶éƒ¨</button>
      <button class="btn ghost" id="btn-jumpUnanswered" data-i18n="jumpUnanswered">è·³åˆ°æœªç­”</button>
    </div>
  </section>

  <!-- Result -->
  <section id="result" class="card hidden">
    <!-- HERO -->
    <div class="hero pop">
      <div class="flex" style="align-items:center; gap:10px;">
        <div class="emoji" id="type-emoji">âœ¨</div>
        <div class="result-type" id="type-code">ENFP</div>
        <div class="badges">
          <span class="tag" id="tie-badge" hidden>è‡ªåŠ¨å¾®è°ƒå·²åº”ç”¨</span>
          <span class="tag" id="name-class"></span>
        </div>
        <div class="right">
          <button class="btn ghost" id="btn-retake" data-i18n="retake">é‡æ–°ä½œç­”</button>
        </div>
      </div>
      <div id="type-desc" class="muted" style="margin-top:8px"></div>
    </div>

    <!-- LETTERS FIRST -->
    <div class="section pop delay1">
      <div class="head"><span class="h-emoji">ğŸ§©</span><span data-i18n="lettersTitle">è¿™4ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ</span></div>
      <div id="letters-wrap" class="letters-grid"></div>
    </div>

    <!-- AXES AFTER LETTERS -->
    <div class="section pop delay2">
      <div class="head"><span class="h-emoji">ğŸ“Š</span><span data-i18n="axesTitle">ç»´åº¦å¼ºåº¦</span></div>
      <div class="axis-grid">
        <div class="axis-card">
          <div class="axis-title"><span class="a-emoji">ğŸ˜„ğŸ§˜</span> E vs I</div>
          <div class="bar"><i id="bar-EI"></i><div class="shimmer"></div></div>
        </div>
        <div class="axis-card">
          <div class="axis-title"><span class="a-emoji">ğŸ”ğŸ’¡</span> S vs N</div>
          <div class="bar"><i id="bar-SN"></i><div class="shimmer"></div></div>
        </div>
        <div class="axis-card">
          <div class="axis-title"><span class="a-emoji">âš™ï¸ğŸ’</span> T vs F</div>
          <div class="bar"><i id="bar-TF"></i><div class="shimmer"></div></div>
        </div>
        <div class="axis-card">
          <div class="axis-title"><span class="a-emoji">ğŸ“…ğŸ²</span> J vs P</div>
          <div class="bar"><i id="bar-JP"></i><div class="shimmer"></div></div>
        </div>
      </div>
    </div>

    <!-- REPS -->
    <div class="section pop delay3">
      <div class="head"><span class="h-emoji">ğŸ­</span><span data-i18n="representatives">ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰</span></div>
      <div id="rep" class="rep-grid"></div>
      <div class="note" data-i18n="repNote" style="margin-top:6px">æ³¨ï¼šç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚</div>
    </div>

    <!-- TIPS & PITFALLS -->
    <div class="grid cols-2">
      <div class="section pop delay4">
        <div class="head"><span class="h-emoji">ğŸ› ï¸</span><span data-i18n="tips">å­¦ä¹ å»ºè®®</span></div>
        <ul id="tips" style="margin:0 0 0 18px"></ul>
      </div>
      <div class="section pop delay4">
        <div class="head"><span class="h-emoji">ğŸ™…</span><span data-i18n="pitfalls">å¸¸è§è¯¯åŒº</span></div>
        <ul id="pitfalls" style="margin:0 0 0 18px"></ul>
      </div>
    </div>

    <div class="field inline gap8">
      <button class="btn secondary pop delay4" id="btn-share" data-i18n="makeShare">ç”Ÿæˆç»“æœå›¾ç‰‡</button>
    </div>

    <canvas id="share-canvas" class="hidden" width="900" height="1300" aria-hidden="true"></canvas>
  </section>
</div>

<footer>
  <div class="f-inner">
    <div class="disclaimer" id="footer-disclaimer">
      å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚
    </div>
    <div class="sign">ç”± Hannah åˆ¶ä½œ</div>
  </div>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite">å·²å¤åˆ¶</div>

<script>
/* ---------- i18n æ–‡æ¡ˆ ---------- */
const i18n = {
  zh:{
    appTitle:"TypeSpark MBTIå­¦ç”Ÿç‰ˆ",
    appSubtitle:"5â€“6åˆ†é’Ÿå®Œæˆï½œç¦»çº¿å¯ç”¨ï½œä¸ç”¨äºè¯Šæ–­",
    welcomeTitle:"æ¬¢è¿ï¼å…ˆå¡«å†™ä¿¡æ¯åå¼€å§‹",
    welcomeTip:"è¯´æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè¯¾å ‚äº¤æµä¸è‡ªæˆ‘äº†è§£ï¼Œéè¯Šæ–­ã€‚å§“åä¸ç­çº§ä»…ç”¨äºç»“æœå±•ç¤ºã€‚",
    name:"å§“å", class:"ç­çº§", start:"å¼€å§‹ç­”é¢˜ â–¶",
    answerAll:"è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®", submit:"æäº¤å¹¶æŸ¥çœ‹ç»“æœ ğŸ‰",
    scrollTop:"å›åˆ°é¡¶éƒ¨", jumpUnanswered:"è·³åˆ°æœªç­”", retake:"é‡æ–°ä½œç­”",
    representatives:"ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰", repNote:"æ³¨ï¼šç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚",
    tips:"å­¦ä¹ å»ºè®®", pitfalls:"å¸¸è§è¯¯åŒº", makeShare:"ç”Ÿæˆç»“æœå›¾ç‰‡",
    motion:"åŠ¨æ•ˆ", motionStandard:"æ ‡å‡†", motionReduced:"å¼±åŠ¨æ•ˆ",
    disclaimerLong:"å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚",
    scale:{1:"éå¸¸ä¸ç¬¦åˆ",2:"ä¸å¤ªç¬¦åˆ",3:"ä¸€èˆ¬/ä¸ç¡®å®š",4:"æ¯”è¾ƒç¬¦åˆ",5:"éå¸¸ç¬¦åˆ"},
    lettersTitle:"è¿™4ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ",
    axesTitle:"ç»´åº¦å¼ºåº¦",
    shareTitle:"TypeSpark ç»“æœå¡", labelName:"å§“å", labelClass:"ç­çº§",
    shareFooter:"ç”± Hannah åˆ¶ä½œï½œä»…ä¾›å‚è€ƒ", tieBadge:"è‡ªåŠ¨å¾®è°ƒå·²åº”ç”¨",
    music:"éŸ³ä¹", musicOn:"å¼€å¯", musicOff:"å…³é—­", volume:"éŸ³é‡"
  },
  en:{
    appTitle:"TypeSpark MBTI Student",
    appSubtitle:"5â€“6 min | Offline | Not for diagnosis",
    welcomeTitle:"Welcome! Fill in info to begin",
    welcomeTip:"Note: For classroom reflection only; Name/Class appear on your result.",
    name:"Name", class:"Class", start:"Start â–¶",
    answerAll:"Please answer all questions", submit:"Submit & See Results ğŸ‰",
    scrollTop:"Back to top", jumpUnanswered:"Jump to unanswered", retake:"Retake",
    representatives:"Representative Figures (for fun)", repNote:"Fan-attributed; multiple interpretations; not official.",
    tips:"Study Tips", pitfalls:"Common Misconceptions", makeShare:"Make Share Image",
    motion:"Motion", motionStandard:"Standard", motionReduced:"Reduced",
    disclaimerLong:"Disclaimer: For reflection only, not diagnostic. Results vary; don't label others. No uploads.",
    scale:{1:"Strongly Disagree",2:"Disagree",3:"Neutral/Unsure",4:"Agree",5:"Strongly Agree"},
    lettersTitle:"What do these 4 letters mean?",
    axesTitle:"Axes Balance",
    shareTitle:"TypeSpark Result Card", labelName:"Name", labelClass:"Class",
    shareFooter:"Made by Hannah | For reference only", tieBadge:"Auto tie-break applied",
    music:"Music", musicOn:"On", musicOff:"Off", volume:"Vol"
  }
};

/* ---------- é¢˜åº“ ---------- */
const QUESTIONS = [
  {id:1, zh:"åœ¨ä¸€ç¾¤ä¸å¤ªç†Ÿçš„äººé‡Œï¼Œæˆ‘ä¹Ÿèƒ½å¾ˆå¿«èŠèµ·æ¥ã€‚", en:"In a group of unfamiliar people, I can strike up conversations quickly.", dim:"EI", side:"E", anchor:true},
  {id:2, zh:"å‚åŠ å®Œçƒ­é—¹æ´»åŠ¨åï¼Œæˆ‘éœ€è¦ä¸€ä¸ªäººå®‰é™ä¸€ä¼šå„¿ã€‚", en:"After lively events, I need quiet alone time to recharge.", dim:"EI", side:"I"},
  {id:3, zh:"å¬åˆ°ä¸€ä¸ªæ–°è¯é¢˜ï¼Œæˆ‘æ›´æ„¿æ„å…ˆè¯´è¯´çœ‹æ³•å†æ…¢æ…¢æƒ³ã€‚", en:"With a new topic, I tend to speak first and think it through as I go.", dim:"EI", side:"E"},
  {id:4, zh:"æœ‰ç©ºæ—¶ï¼Œæˆ‘æ›´å–œæ¬¢ç‹¬å¤„åšè‡ªå·±çš„å°å…´è¶£ã€‚", en:"In free time, I prefer solo hobbies over social activities.", dim:"EI", side:"I"},
  {id:5, zh:"é•¿æ—¶é—´ç‹¬å¤„ä¼šè®©æˆ‘æ„Ÿè§‰ç²¾åŠ›ä¸‹é™ã€‚", en:"Too much time alone drains my energy.", dim:"EI", side:"E"},
  {id:6, zh:"æˆ‘æ›´ä¿¡èµ–èƒ½è¢«è¯æ˜çš„äº‹å®ï¼Œè€Œä¸æ˜¯â€œçµæ„Ÿç›´è§‰â€ã€‚", en:"I trust verifiable facts more than flashes of intuition.", dim:"SN", side:"S"},
  {id:7, zh:"æˆ‘å¸¸å¸¸å…ˆæœ‰ä¸€ä¸ªæ•´ä½“æƒ³æ³•ï¼Œå†å»è¡¥ç»†èŠ‚ã€‚", en:"I often jump to a big picture idea and fill details later.", dim:"SN", side:"N", anchor:true},
  {id:8, zh:"åšè®¡åˆ’æ—¶ï¼Œæˆ‘å–œæ¬¢ä¸€æ­¥ä¸€æ­¥æŒ‰æµç¨‹æ¥ã€‚", en:"When planning, I prefer step-by-step procedures.", dim:"SN", side:"S"},
  {id:9, zh:"é¢å¯¹é¢˜ç›®ï¼Œæˆ‘ä¼šå…ˆæƒ³â€œè¿˜æœ‰æ²¡æœ‰æ›´ç‰¹åˆ«çš„åšæ³•â€ã€‚", en:"Facing a task, I first think: is there a more novel way?", dim:"SN", side:"N"},
  {id:10, zh:"ç›¸æ¯”ç°åœ¨ï¼Œæˆ‘æ›´è¢«æœªæ¥çš„å¯èƒ½æ€§æ‰€å¸å¼•ã€‚", en:"I'm more drawn to future possibilities than the present details.", dim:"SN", side:"N"},
  {id:11, zh:"åšå†³å®šæ—¶ï¼Œæˆ‘ä¼˜å…ˆè€ƒè™‘è§„åˆ™å’Œé€»è¾‘æ˜¯å¦ä¸€è‡´ã€‚", en:"When deciding, I prioritize consistency of rules and logic.", dim:"TF", side:"T"},
  {id:12, zh:"å¦‚æœä¸€ä¸ªåšæ³•ä¼šä¼¤å®³åˆ°åˆ«äººæ„Ÿå—ï¼Œæˆ‘ä¼šé‡æ–°æƒè¡¡ã€‚", en:"If a choice may hurt others' feelings, I reconsider.", dim:"TF", side:"F", anchor:true},
  {id:13, zh:"æ¥å—æ‰¹è¯„æ—¶ï¼Œæˆ‘æ›´æƒ³çŸ¥é“å…·ä½“äº‹å®ä¸è¯æ®ã€‚", en:"When criticized, I want concrete facts and evidence.", dim:"TF", side:"T"},
  {id:14, zh:"æˆ‘å¸¸æŠŠç»´æŠ¤å’Œè°å…³ç³»æ”¾åœ¨ç»“æœä¹‹å‰ã€‚", en:"I often prioritize harmony over outcomes.", dim:"TF", side:"F"},
  {id:15, zh:"å½“â€œåˆç†â€å’Œâ€œé¡¾åŠæ„Ÿå—â€å†²çªæ—¶ï¼Œæˆ‘ä¼šå°½é‡å¯»æ‰¾ä¸¤å…¨æ–¹æ¡ˆã€‚", en:"When logic and feelings conflict, I seek a both-win solution.", dim:"TF", side:"F"},
  {id:16, zh:"æˆ‘å–œæ¬¢å°½æ—©æŠŠäº‹æƒ…å®šä¸‹æ¥ï¼Œæœ‰æ˜ç¡®çš„æ—¶é—´è¡¨ã€‚", en:"I prefer to decide early and have a clear schedule.", dim:"JP", side:"J", anchor:true},
  {id:17, zh:"è®¡åˆ’è¢«æ‰“ä¹±æ—¶ï¼Œæˆ‘ä¹Ÿèƒ½è¿…é€Ÿå³å…´è°ƒæ•´ã€‚", en:"When plans change, I can adapt quickly and improvise.", dim:"JP", side:"P"},
  {id:18, zh:"æˆ‘ä¹ æƒ¯æŠŠä»»åŠ¡æå‰å®Œæˆï¼Œè€Œä¸æ˜¯æœ€åä¸€å¤©èµ¶ã€‚", en:"I tend to finish tasks early rather than at the last minute.", dim:"JP", side:"J"},
  {id:19, zh:"æˆ‘æ›´äº«å—ä¿æŒé€‰æ‹©çš„å¼€æ”¾ï¼Œè€Œä¸æ˜¯è¿‡æ—©å®šæ¡ˆã€‚", en:"I enjoy keeping options open rather than deciding too early.", dim:"JP", side:"P"},
  {id:20, zh:"é¢å¯¹ä½œä¸šï¼Œæˆ‘ä¼šå…ˆå¼€å·¥ï¼Œè¾¹åšè¾¹è°ƒæ•´æ–¹å‘ã€‚", en:"For assignments, I start and adjust direction as I go.", dim:"JP", side:"P"},
];

/* ---------- å­—æ¯ä¿¡æ¯ï¼ˆå¤§å­—æ¯ + è‹±æ–‡ + ä¸­æ–‡ + è§£é‡Šï¼‰ ---------- */
const LETTER_INFO = {
  E:{emoji:'ğŸ˜„', en:'Extraversion', zh:'å¤–å‘', desc:{zh:'ä»ä¸äººäº’åŠ¨ä¸­â€œå……ç”µâ€ï¼Œå¸¸è¾¹è¯´è¾¹æƒ³ã€‚', en:'Energized by interaction; think while speaking.'}},
  I:{emoji:'ğŸ§˜', en:'Introversion', zh:'å†…å‘', desc:{zh:'ä»ç‹¬å¤„ä¸­â€œå……ç”µâ€ï¼Œå…ˆæƒ³å¥½å†å¼€å£ã€‚', en:'Energized by solitude; think before speaking.'}},
  S:{emoji:'ğŸ”', en:'Sensing', zh:'å®æ„Ÿ', desc:{zh:'é‡è§†ç°åœ¨ä¸ç»†èŠ‚ï¼Œè„šè¸å®åœ°ã€‚', en:'Focus on facts and details; grounded.'}},
  N:{emoji:'ğŸ’¡', en:'iNtuition', zh:'ç›´è§‰', desc:{zh:'å…³æ³¨å¯èƒ½æ€§ä¸å¤§å›¾æ™¯ï¼Œçˆ±è”æƒ³ã€‚', en:'See possibilities and the big picture.'}},
  T:{emoji:'âš™ï¸', en:'Thinking', zh:'æ€è€ƒ', desc:{zh:'ä¼˜å…ˆé€»è¾‘ä¸åŸåˆ™ï¼Œè®²é“ç†ã€‚', en:'Prioritize logic and principles.'}},
  F:{emoji:'ğŸ’', en:'Feeling', zh:'æƒ…æ„Ÿ', desc:{zh:'ä¼˜å…ˆäººå’Œæ„Ÿå—ï¼Œè®²å…±æƒ…ã€‚', en:'Prioritize people and feelings.'}},
  J:{emoji:'ğŸ“…', en:'Judging', zh:'åˆ¤æ–­', desc:{zh:'å–œæ¬¢å®šè®¡åˆ’ï¼Œæœ‰èŠ‚å¥åœ°æ¨è¿›ã€‚', en:'Prefer plans and structure.'}},
  P:{emoji:'ğŸ²', en:'Perceiving', zh:'æ„ŸçŸ¥', desc:{zh:'ä¿æŒçµæ´»ï¼Œè¾¹èµ°è¾¹è°ƒã€‚', en:'Prefer flexibility and spontaneity.'}},
};
const LETTER_GRADS = {
  E:['#8B77FF','#4DA3FF'], I:['#66E3A4','#4DA3FF'], S:['#4DA3FF','#79C8FF'], N:['#FFB84D','#FF9E4D'],
  T:['#66E3A4','#2ECC9A'], F:['#FF6B6B','#FF8FA3'], J:['#FFB84D','#FFC46B'], P:['#4DA3FF','#66E3A4']
};

/* ---------- ç±»å‹æ¡£æ¡ˆï¼ˆå«ä»£è¡¨äººç‰©ï¼‰ ---------- */
const TYPE_PROFILES = {
  ISTJ:{ emoji:'ğŸ›¡ï¸',
    desc:{ zh:"æ³¨é‡äº‹å®ä¸è´£ä»»ï¼Œåšäº‹å¯é ç¨³å¥ã€‚å–œæ¬¢æ˜ç¡®è§„åˆ™å’Œæ­¥éª¤ï¼Œæ“…é•¿é•¿æœŸåšæŒã€‚", en:"Reliable, fact-focused, and responsible. Prefer clear rules and steady follow-through." },
    reps:{ zh:[{name:"Captain America å²è’‚å¤«Â·ç½—æ°æ–¯ï¼ˆMarvelï¼‰", why:"çºªå¾‹æ„Ÿå¼ºã€å®ˆè§„çŸ©ã€è¯´åˆ°åšåˆ°ã€‚", quote:"I can do this all day."},{name:"éƒ­é–ï¼ˆå°„é›•è‹±é›„ä¼ ï¼‰", why:"è¸å®å®ˆä¿¡ï¼Œç»ƒåŠŸæŒ‰æ­¥éª¤æ¥ï¼Œå¯é é˜Ÿå‹ã€‚", quote:"æŒ‰å¸ˆçˆ¶æ•™çš„æ¥ã€‚"}],
           en:[{name:"Captain America (Marvel)", why:"Disciplined, duty-driven, keeps promises.", quote:"I can do this all day."},{name:"Guo Jing (Legend of the Condor Heroes)", why:"Steady and trustworthy; follows rules.", quote:"Follow the master's teaching."}] }
  },
  ISFJ:{ emoji:'ğŸ«¶',
    desc:{ zh:"æ¸©å’Œä½“è´´ã€è®¤çœŸå®ˆæŠ¤ä»–äººã€‚é‡è§†ç»†èŠ‚ä¸ç§©åºï¼Œå–œæ¬¢è®©å‘¨å›´æ›´ç¨³å®šå®‰å¿ƒã€‚", en:"Gentle, caring, detail-oriented; keep things steady and safe for others." },
    reps:{ zh:[{name:"Samwise å±±å§†ï¼ˆLOTRï¼‰", why:"é»˜é»˜ç…§é¡¾åŒä¼´ã€èƒ½åƒè‹¦ã€è€å¿ƒç»†è‡´ã€‚", quote:"æˆ‘ä¸ä¼šæŠ›ä¸‹ä½ ï¼Œä½›ç½—å¤šå…ˆç”Ÿã€‚"}, {name:"æ²™æ‚Ÿå‡€ï¼ˆè¥¿æ¸¸è®°ï¼‰", why:"ç¨³é‡è€å®ã€æ”¶æ‹¾æ®‹å±€çš„å®ˆæŠ¤å‹ä¼™ä¼´ã€‚", quote:"å¸ˆçˆ¶æ…¢èµ°ï¼Œè°¨æ…ä¸ºä¸Šã€‚"}],
           en:[{name:"Samwise Gamgee (LOTR)", why:"Quietly supportive, loyal, diligent.", quote:"I won't leave you, Mr. Frodo."}, {name:"Sha Wujing (Journey to the West)", why:"Calm, reliable, keeps team steady.", quote:"Steady and careful."}] }
  },
  INFJ:{ emoji:'ğŸ”®',
    desc:{ zh:"æ´å¯Ÿäººå¿ƒã€å…³æ³¨æ„ä¹‰ã€‚å¸¸ä»å®è§‚æ„¿æ™¯æ€è€ƒé—®é¢˜ï¼Œé‡è§†ä»·å€¼è§‚ä¸é•¿è¿œå½±å“ã€‚", en:"Insightful and purpose-driven; big-picture thinkers guided by values." },
    reps:{ zh:[{name:"è‰¾è Elsaï¼ˆFrozenï¼‰", why:"æ¸´æœ›åšæ­£ç¡®çš„äº‹ï¼Œå†…åœ¨ä»·å€¼æ„Ÿå¼ºã€‚", quote:"Let it go."},{name:"æ¢…é•¿è‹ï¼ˆç…çŠæ¦œï¼‰", why:"å¿ƒæœ‰å¤§ä¹‰ã€è°‹åˆ’é•¿è¿œã€å…³ç…§ä¼—äººå‘½è¿ã€‚", quote:"æ—¢ç„¶é€‰æ‹©äº†ï¼Œå°±èµ°åˆ°åº•ã€‚"}],
           en:[{name:"Elsa (Frozen)", why:"Values-driven, seeks the right thing.", quote:"Let it go."},{name:"Mei Changsu (Nirvana in Fire)", why:"Visionary strategist for a just cause.", quote:"See it through."}] }
  },
  INTJ:{ emoji:'â™Ÿï¸',
    desc:{ zh:"å–„äºç³»ç»Ÿè§„åˆ’ä¸ç­–ç•¥æ€è€ƒï¼Œå–œæ¬¢é«˜æ•ˆä¸è‡ªæ´½çš„æ–¹æ¡ˆã€‚ç‹¬ç«‹å†·é™ï¼Œé¢å‘é•¿æœŸç›®æ ‡ã€‚", en:"Strategic and systematic; independent, long-term planners." },
    reps:{ zh:[{name:"å¥‡å¼‚åšå£« Doctor Strangeï¼ˆMarvelï¼‰", why:"ç†æ€§è®¡ç®—ã€é¢„æ¼”æœªæ¥ã€å¯»æ±‚æœ€ä½³è§£ã€‚", quote:"I've seen 14,000,605 outcomes."},{name:"è¯¸è‘›äº®ï¼ˆä¸‰å›½æ¼”ä¹‰ï¼‰", why:"è¿ç­¹å¸·å¹„ã€è®²æ±‚ç­–ç•¥ä¸æ•ˆç‡ã€‚", quote:"æœªé›¨ç»¸ç¼ªï¼Œæ–¹èƒ½è‡´èƒœã€‚"}],
           en:[{name:"Doctor Strange (Marvel)", why:"Calculates scenarios and optimizes outcomes.", quote:"I've seen 14,000,605 outcomes."},{name:"Zhuge Liang (Romance of the Three Kingdoms)", why:"Strategic mastermind.", quote:"Prepare before it rains."}] }
  },
  ISTP:{ emoji:'ğŸ› ï¸',
    desc:{ zh:"å†·é™å®å¹²ã€å–œæ¬¢åŠ¨æ‰‹è§£å†³é—®é¢˜ã€‚é‡åˆ°æŒ‘æˆ˜èƒ½è¿…é€Ÿåˆ†æå¹¶é‡‡å–è¡ŒåŠ¨ã€‚", en:"Calm, hands-on problem solvers who act swiftly under pressure." },
    reps:{ zh:[{name:"é»‘å¯¡å¦‡ Black Widowï¼ˆMarvelï¼‰", why:"ä¸´åœºååº”å¿«ï¼Œæ“…é•¿å®é™…æ“ä½œã€‚", quote:"I get the job done."},{name:"æ­¦æ¾ï¼ˆæ°´æµ’ä¼ ï¼‰", why:"å½“æœºç«‹æ–­ï¼ŒåŠ¨æ‰‹èƒ½åŠ›å¼ºã€‚", quote:"è·¯è§ä¸å¹³ï¼Œæ‹”åˆ€ç›¸åŠ©ã€‚"}],
           en:[{name:"Black Widow (Marvel)", why:"Quick, tactical, action-first.", quote:"I get the job done."},{name:"Wu Song (Water Margin)", why:"Decisive and skillful.", quote:"Help when injustice appears."}] }
  },
  ISFP:{ emoji:'ğŸ¨',
    desc:{ zh:"æ¸©æŸ”å†…æ•›ã€é‡è§†å½“ä¸‹ä½“éªŒä¸ä¸ªäººä»·å€¼ã€‚å¯¹ç¾æ„Ÿä¸å’Œè°æ•æ„Ÿï¼Œåšäº‹çœŸè¯šè‡ªç„¶ã€‚", en:"Gentle and authentic; sensitive to aesthetics and harmony." },
    reps:{ zh:[{name:"è±æˆˆæ‹‰æ–¯ Legolasï¼ˆLOTRï¼‰", why:"å®‰é™æ•é”ã€åŠ¨ä½œä¼˜é›…ã€‚", quote:"The forest speaks."},{name:"å°é¾™å¥³ï¼ˆç¥é›•ä¾ ä¾£ï¼‰", why:"æ¸…å†·è‡ªæŒã€é‡æƒ…çœŸè¯šã€‚", quote:"æ—¢ç„¶è®¤å®šï¼Œå°±ä¸å˜ã€‚"}],
           en:[{name:"Legolas (LOTR)", why:"Quietly precise, graceful.", quote:"The forest speaks."},{name:"Xiaolongnu (ROCH)", why:"Calm, sincere.", quote:"Once chosen, unwavering."}] }
  },
  INFP:{ emoji:'ğŸŒˆ',
    desc:{ zh:"ç†æƒ³ä¸»ä¹‰ä¸”å¯ŒåŒç†å¿ƒï¼Œå…³æ³¨å†…åœ¨ä»·å€¼ä¸ä¸ªäººæ„ä¹‰ã€‚", en:"Idealistic and empathetic; value inner meaning." },
    reps:{ zh:[{name:"ä½›ç½—å¤š Frodoï¼ˆLOTRï¼‰", why:"èƒŒè´Ÿä½¿å‘½ä¹Ÿä¸æ”¾å¼ƒå–„è‰¯ã€‚", quote:"æˆ‘æŠŠå®ƒå¸¦åˆ°æœ«æ—¥ç«å±±ã€‚"}, {name:"æ—é»›ç‰ï¼ˆçº¢æ¥¼æ¢¦ï¼‰", why:"æƒ…æ„Ÿç»†è…»ã€çœŸè¯šæ•æ„Ÿã€‚", quote:"è´¨æœ¬æ´æ¥è¿˜æ´å»ã€‚"}],
           en:[{name:"Frodo (LOTR)", why:"Guards kindness under burden.", quote:"I will take the Ring to Mordor."},{name:"Lin Daiyu (DRC)", why:"Sensitive and sincere.", quote:"Pure at heart."}] }
  },
  INTP:{ emoji:'ğŸ§ ',
    desc:{ zh:"å¥½å¥‡å¿ƒå¼ºã€æ“…é•¿åˆ†æï¼Œå–œæ¬¢æ‹†è§£é—®é¢˜ä¸æ„å»ºæ¨¡å‹ã€‚", en:"Curious analysts who deconstruct problems and build models." },
    reps:{ zh:[{name:"èˆ’è‰ Shuriï¼ˆBlack Pantherï¼‰", why:"æŠ€æœ¯è„‘æ´å¤šã€çƒ­çˆ±å‘æ˜ã€‚", quote:"Just improve it."},{name:"ç¦å°”æ‘©æ–¯ Sherlock Holmes", why:"æ¨ç†è‡³ä¸Šï¼Œé€»è¾‘åˆ¨æ ¹é—®åº•ã€‚", quote:"æ•°æ®ï¼ç»™æˆ‘æ•°æ®ï¼"}],
           en:[{name:"Shuri (Black Panther)", why:"Inventive, analytical.", quote:"Just because it works can still be improved."},{name:"Sherlock Holmes", why:"Logic-first detective.", quote:"Data, data, data!"}] }
  },
  ESTP:{ emoji:'âš¡',
    desc:{ zh:"è¡ŒåŠ¨æ´¾ä¸ç°å®ä¸»ä¹‰è€…ï¼Œå–œæ¬¢ç›´æ¥ä¸Šæ‰‹ã€ç°åœºä¼˜åŒ–ã€‚", en:"Action-oriented realists who optimize on the spot." },
    reps:{ zh:[{name:"æ°å…‹Â·æ–¯æ´¾ç½— Jack Sparrow", why:"ä¸´åœºååº”å¿«ã€ä¼šç©è½¬å±€é¢ã€‚", quote:"å¸¦ç‚¹å°è®¡åˆ’ã€‚"}, {name:"æé€µï¼ˆæ°´æµ’ä¼ ï¼‰", why:"ç›´æ¥ã€ç—›å¿«ã€é‡è¡ŒåŠ¨ã€‚", quote:"æœ‰äº‹å°±ä¸Šï¼"}],
           en:[{name:"Jack Sparrow", why:"Witty, spontaneous.", quote:"I've got a plan... sort of."},{name:"Li Kui (Water Margin)", why:"Direct and action-first.", quote:"Go for it!"}] }
  },
  ESFP:{ emoji:'ğŸ‰',
    desc:{ zh:"çƒ­æƒ…å¤–å‘ã€å¸¦åŠ¨æ°”æ°›ï¼Œä¹äºåˆ†äº«ä¸å°è¯•ã€‚", en:"Energetic, people-focused, love sharing and new experiences." },
    reps:{ zh:[{name:"èšäºº Scott Langï¼ˆMarvelï¼‰", why:"ä¹è§‚ä¼šç©æ¢—ï¼Œå¸¦åŠ¨å›¢é˜Ÿæ°”æ°›ã€‚", quote:"è¿™ä¸å°±æ˜¯ä¸ªå¤§ç‚¹çš„äº‹å—ï¼Ÿ"}, {name:"çŒªå…«æˆ’ï¼ˆè¥¿æ¸¸è®°ï¼‰", why:"çˆ±çƒ­é—¹ã€æœ‰äººæƒ…å‘³ã€‚", quote:"å¸ˆå…„åˆ«æ€¥ï¼Œå…ˆåƒå£å„¿å†è¯´ã€‚"}],
           en:[{name:"Ant-Man Scott Lang (Marvel)", why:"Playful and upbeat.", quote:"It's just... bigger."},{name:"Zhu Bajie (JTTW)", why:"Fun-loving, people-oriented.", quote:"Don't rush, enjoy the bite."}] }
  },
  ENFP:{ emoji:'âœ¨',
    desc:{ zh:"åˆ›æ„å……æ²›ã€ä¹è§‚å¤–å‘ã€‚å¯¹å¯èƒ½æ€§æ•æ„Ÿï¼Œå–œæ¬¢åˆä½œå…±åˆ›ã€‚", en:"Creative and enthusiastic; sensitive to possibilities; collaborative." },
    reps:{ zh:[{name:"èœ˜è››ä¾  Peter Parkerï¼ˆMarvelï¼‰", why:"çƒ­å¿ƒåŠ©äººã€ç‚¹å­å¤šã€‚", quote:"èƒ½åŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ã€‚"}, {name:"å“ªå’ï¼ˆå“ªå’ä¹‹é­”ç«¥é™ä¸–ï¼‰", why:"ä¸æŒ‰å¥—è·¯ã€ç‡ƒç‚¹é«˜ã€‚", quote:"æˆ‘å‘½ç”±æˆ‘ï¼Œä¸ç”±å¤©ã€‚"}],
           en:[{name:"Spider-Man (Marvel)", why:"Helpful, witty.", quote:"With great power comes great responsibility."},{name:"Nezha", why:"Unconventional and fiery.", quote:"My fate is mine."}] }
  },
  ENTP:{ emoji:'ğŸš€',
    desc:{ zh:"å–„äºè¾©æ€ä¸è·¨ç•Œè”æƒ³ï¼Œå–œæ¬¢å°è¯•æ–°å¥‡åšæ³•ï¼ŒæŒ‘æˆ˜è®¾å®šã€‚", en:"Debaters and tinkerers; love novel approaches and challenging assumptions." },
    reps:{ zh:[{name:"æ‰˜å°¼Â·æ–¯å¡”å…‹ Iron Manï¼ˆMarvelï¼‰", why:"è„‘æ´ä¸å®éªŒä¸åœï¼Œæ•¢å¼€æ–°è·¯ã€‚", quote:"æˆ‘å°±æ˜¯é’¢é“ä¾ ã€‚"}, {name:"å­™æ‚Ÿç©ºï¼ˆè¥¿æ¸¸è®°ï¼‰", why:"ä¸æŒ‰å¸¸è§„ã€ç‚¹å­å¤šã€‚", quote:"ä¿ºè€å­™æ¥ä¹Ÿï¼"}],
           en:[{name:"Tony Stark (Marvel)", why:"Inventive, bold.", quote:"I am Iron Man."},{name:"Sun Wukong (JTTW)", why:"Rule-bender with tricks.", quote:"Here comes the Monkey King!"}] }
  },
  ESTJ:{ emoji:'ğŸ“£',
    desc:{ zh:"ç»„ç»‡ä¸æ‰§è¡ŒåŠ›å¼ºï¼Œè¿½æ±‚æ¸…æ™°è§„åˆ™ä¸æ•ˆç‡ï¼Œæ¨åŠ¨äº‹æƒ…è½åœ°ã€‚", en:"Organized, efficient drivers who get things done." },
    reps:{ zh:[{name:"å°¼å…‹Â·å¼—ç‘ Nick Furyï¼ˆMarvelï¼‰", why:"æ­ç­å­ã€å®šç›®æ ‡ã€æ´¾ä»»åŠ¡ã€‚", quote:"å¤ä»‡è€…ï¼Œé›†åˆã€‚"}, {name:"å…³ç¾½ï¼ˆä¸‰å›½æ¼”ä¹‰ï¼‰", why:"å®ˆè§„åˆ™ã€è®²ä¿¡ä¹‰ã€è¯´å¹²å°±å¹²ã€‚", quote:"ä¹‰å­—å½“å¤´ã€‚"}],
           en:[{name:"Nick Fury (Marvel)", why:"Builds teams, sets missions.", quote:"Avengers, assemble."},{name:"Guan Yu (RTK)", why:"Duty-bound and decisive.", quote:"Honor first."}] }
  },
  ESFJ:{ emoji:'ğŸ¤',
    desc:{ zh:"ä½“è´´åŠ¡å®ï¼Œé‡è§†å›¢é˜Ÿæ°›å›´ä¸åä½œï¼Œå–„äºåè°ƒä¸æ”¯æŒã€‚", en:"Caring, practical coordinators who keep teams harmonious." },
    reps:{ zh:[{name:"å®‰å¨œ Annaï¼ˆFrozenï¼‰", why:"çƒ­å¿ƒç…§é¡¾ä»–äººã€ä¸»åŠ¨ç»´æŠ¤å…³ç³»ã€‚", quote:"æˆ‘é™ªä½ ã€‚"}, {name:"åˆ˜å¤‡ï¼ˆä¸‰å›½æ¼”ä¹‰ï¼‰", why:"å–„ç»“äººå¿ƒã€ä¼šç»„ç»‡å›¢é˜Ÿã€‚", quote:"åŒå¿ƒååŠ›ã€‚"}],
           en:[{name:"Anna (Frozen)", why:"Warm, relationship-centered.", quote:"I'm with you."},{name:"Liu Bei (RTK)", why:"Unites people.", quote:"Work as one."}] }
  },
  ENFJ:{ emoji:'ğŸŒŸ',
    desc:{ zh:"å¯Œæœ‰æ„ŸæŸ“åŠ›çš„å¼•å¯¼è€…ï¼Œå…³æ³¨ä»–äººæˆé•¿ä¸å…±åŒç›®æ ‡ã€‚", en:"Inspiring mentors focused on growth and shared goals." },
    reps:{ zh:[{name:"é˜¿ä¸æ€Â·é‚“å¸ƒåˆ©å¤šï¼ˆHarry Potterï¼‰", why:"å¼•å¯¼å­¦ç”Ÿã€å¼ºè°ƒé€‰æ‹©ä¸æ‹…å½“ã€‚", quote:"å†³å®šæˆ‘ä»¬çš„æ˜¯é€‰æ‹©ã€‚"}, {name:"æœ¨æ³•æ²™ Mufasaï¼ˆThe Lion Kingï¼‰", why:"ä»¥èº«ä½œåˆ™ã€å®ˆæŠ¤æ—ç¾¤ã€‚", quote:"è®°ä½ä½ æ˜¯è°ã€‚"}],
           en:[{name:"Albus Dumbledore", why:"Guides others; values choices.", quote:"It is our choices that show who we are."},{name:"Mufasa", why:"Lead by example.", quote:"Remember who you are."}] }
  },
  ENTJ:{ emoji:'ğŸ†',
    desc:{ zh:"ç›®æ ‡å¯¼å‘ã€æœæ–­å†³ç­–ï¼Œå–„äºæ•´åˆèµ„æºå®ç°æ„¿æ™¯ã€‚", en:"Decisive, goal-driven leaders who build systems to realize visions." },
    reps:{ zh:[{name:"ç­éœ¸ Thanosï¼ˆMarvelï¼‰", why:"å¼ºçƒˆç›®æ ‡æ„Ÿï¼Œç»Ÿç­¹å…¨å±€ï¼ˆè™šæ„è§’è‰²ï¼Œä»…ä½œåŸå‹ï¼‰ã€‚", quote:"æˆ‘å‘½ä¸­æ³¨å®šã€‚"}, {name:"æ›¹æ“ï¼ˆä¸‰å›½æ¼”ä¹‰ï¼‰", why:"é›„æ‰å¤§ç•¥ã€ç»„ç»‡æ•´åˆèƒ½åŠ›å¼ºã€‚", quote:"å½¢è±¡å¤šæœ‰äº‰è®®ï¼Œæ­¤å¤„ä»…ä½œå…¸å‹ã€‚"}],
           en:[{name:"Thanos (Marvel)", why:"Relentless vision (fictional archetype).", quote:"I am inevitable."},{name:"Cao Cao (RTK)", why:"Ambitious organizer.", quote:"Archetypal commander."}] }
  }
};

/* ---------- å»ºè®® & è¯¯åŒºï¼ˆå£è¯­åŒ–ï¼‰ ---------- */
const SUGGESTIONS = {
  zh:{
    E:["å‘è¨€å‰å…ˆåˆ—3ä¸ªå…³é”®è¯ï¼Œæ›´èšç„¦ã€‚","è®¨è®ºæ—¶ç»™å†…å‘åŒå­¦1åˆ†é’Ÿå®‰é™æ€è€ƒã€‚"],
    I:["é‡è¦å‘è¨€å…ˆå†™è¦ç‚¹å¡ï¼Œåº•æ°”æ›´è¶³ã€‚","ä¸æƒ³æŠ¢è¯å°±å…ˆç‚¹ä¸ªèµï¼Œå†è¡¥è§‚ç‚¹ã€‚"],
    S:["å…ˆæŠŠâ€œä¾‹é¢˜+æ­¥éª¤â€åƒé€ï¼Œå†ä¸Šéš¾é¢˜ã€‚","ç¬”è®°æ ‡æ³¨ï¼šäº‹å®/æ•°æ®/æ­¥éª¤ã€‚"],
    N:["æŠŠå¥½ç‚¹å­è½æˆâ€œä¸‰æ­¥èµ°â€ã€‚","æ¯æ®µæ—¶é—´åšç°å®æ£€æŸ¥ï¼šç›®æ ‡â†’è¯æ®â†’ä¸‹ä¸€æ­¥ã€‚"],
    T:["ç»“è®ºååŠ ä¸€å¥â€œå¯¹äººçš„å½±å“â€ã€‚","å†³ç­–åˆ—å‡ºä¸¤æ¡åŸåˆ™å’Œä¸€æ¡ä¾‹å¤–ã€‚"],
    F:["è¡¨è¾¾å…³å¿ƒçš„åŒæ—¶ï¼Œä¹Ÿè¡¥ä¸Šä¸¤ä¸ªå®¢è§‚äº‹å®ã€‚","å…ˆå¤è¿°å¯¹æ–¹è§‚ç‚¹ï¼Œç©ºæ°”ä¼šæŸ”å’Œå¾ˆå¤šã€‚"],
    J:["è®¡åˆ’é‡Œé¢„ç•™10â€“20%ç¼“å†²ã€‚","æŠŠå¤§ä»»åŠ¡æ‹†æˆå°å¡ç‰‡ï¼Œæ­¥æ­¥æ¨è¿›ã€‚"],
    P:["å…ˆåšæœ€å°å¯è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰ã€‚","è®¾ä¸€ä¸ªè½¯DDLï¼Œé¿å…æœ€åä¸€æ™šçˆ†å†²ã€‚"]
  },
  en:{
    E:["Outline 3 keywords first.","Give quiet peers a 1â€‘min think time."],
    I:["Write a cue card before speaking.","Nod first, then add your points."],
    S:["Master examples and steps first.","Tag notes: fact/data/step."],
    N:["Turn ideas into a 3â€‘step plan.","Do a reality check regularly."],
    T:["State people impact after your logic.","List two principles + one exception."],
    F:["Pair empathy with two facts.","Paraphrase first to lower tension."],
    J:["Leave 10â€“20% buffer.","Break tasks into bite-size cards."],
    P:["Build an MVP and iterate.","Set a soft deadline to avoid rush."]
  }
};
const PITFALLS = {
  zh:{
    E:["å¤–å‘ä¸ç­‰äºçˆ±æŠ¢è¯ï¼›ä¼šå€¾å¬çš„å¤–å‘æ›´æœ‰é­…åŠ›ã€‚","çˆ±ç¤¾äº¤â‰ ä¸€å®šä¼šé¢†å¯¼ï¼Œé¢†å¯¼åŠ›è¦ç»ƒå‡ºæ¥ã€‚"],
    I:["å–œæ¬¢å®‰é™ä¸ç­‰äºâ€œç¤¾æâ€ï¼Œä½ åªæ˜¯éœ€è¦ç‹¬å¤„æ¥å……ç”µã€‚","å°‘è¯´è¯â‰ æ²¡æƒ³æ³•ï¼Œå‡†å¤‡å¥½å†è¯´å³å¯ã€‚"],
    S:["é‡ç»†èŠ‚ä¸ç­‰äºæ²¡åˆ›æ„ï¼Œä½ æ˜¯åœ¨æ‰“åœ°åŸºã€‚","çˆ±è¯æ®ä¸ä»£è¡¨ä¿å®ˆã€‚"],
    N:["æƒ³è±¡å¤šä¸ç­‰äºä¸è¸å®ï¼ŒæŠŠæƒ³æ³•è½åœ°å°±å¾ˆå¼ºã€‚","è„‘æ´å¤§ä¹Ÿåˆ«è·³è¿‡åŸºæœ¬åŠŸã€‚"],
    T:["è®²é€»è¾‘ä¸ç­‰äºå†·æ¼ ï¼Œè¯­æ°”æŸ”å’Œä¸€æ ·æ¸…æ™°ã€‚","ç›´æ¥ç›´å»â‰ ä¸ç»™é¢å­ï¼Œå…ˆç¡®è®¤æ„Ÿå—æ›´å¥½æ²Ÿé€šã€‚"],
    F:["é¡¾åŠæ„Ÿå—ä¸ç­‰äºä¸ç†æ€§ï¼Œä½ åªæ˜¯å¤šçœ‹äº†ä¸€æ­¥äººå¿ƒã€‚","å–„è‰¯â‰ å¥½è¯´è¯ï¼Œè¾¹ç•Œæ„Ÿå¾ˆé‡è¦ã€‚"],
    J:["çˆ±è®¡åˆ’ä¸ç­‰äºæ­»æ¿ï¼Œé¢„ç•™å¼¹æ€§å°±å¾ˆç¨³ã€‚","æŠŠäº‹å®šä¸‹æ¥â‰ æ§åˆ¶åˆ«äººï¼Œæ˜¯ä¸ºäº†æ•ˆç‡ã€‚"],
    P:["çµæ´»ä¸ç­‰äºæ‹–å»¶ï¼Œè®¾å°é‡Œç¨‹ç¢‘å°±è¡Œã€‚","ä¸æƒ³å¤ªæ—©å®šæ¡ˆâ‰ æ²¡ä¸»è§ï¼Œä½ åœ¨æ”¶é›†ä¿¡æ¯ã€‚"]
  },
  en:{
    E:["Extravert â‰  interrupter; listening makes you shine.","Peopleâ€‘person â‰  automatic leader; itâ€™s trained."],
    I:["Quiet â‰  shy; you recharge alone.","Few words â‰  few ideas; prep then speak."],
    S:["Detail focus â‰  no creativity; itâ€™s the foundation.","Evidenceâ€‘loving â‰  conservative."],
    N:["Imagination â‰  impractical; ship it.","Big ideas still need basics."],
    T:["Logical â‰  cold; warm tone still clear.","Direct â‰  rude; acknowledge feelings first."],
    F:["Empathy â‰  illogical; it's human data too.","Kind â‰  pushâ€‘over; boundaries matter."],
    J:["Planning â‰  rigid; add buffer and flex.","Deciding early â‰  controlling othersâ€”clarity helps."],
    P:["Flexible â‰  procrastinator; use miniâ€‘milestones.","Keeping options open â‰  no opinion; gathering info."]
  }
};

/* ---------- å·¥å…· & çŠ¶æ€ ---------- */
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));
const state = { lang:'zh', motion:'standard', answers:{}, shuffled:[], name:'', cls:'', result:null, tieBreakUsed:false,
  music:{ enabled:false, volume:0.2 } };

/* ---------- å°å·¥å…· ---------- */
function showToast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500); }
function shuffle(a){ return a.map(x=>[Math.random(),x]).sort((p,q)=>p[0]-q[0]).map(x=>x[1]); }
function avg(arr){ return arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:0; }

/* ---------- è¯­è¨€ & åŠ¨æ•ˆ ---------- */
function applyLang(){
  const dict=i18n[state.lang];
  $$('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n'); const parts=key.split('.'); let val=dict;
    for(const p of parts){ val=val?.[p]; }
    if(typeof val==='string') el.textContent=val;
  });
  $('#footer-disclaimer').textContent=dict.disclaimerLong;
  $$('.chip[data-val]').forEach(ch=>{ ch.textContent=dict.scale[ch.getAttribute('data-val')] || ch.getAttribute('data-val'); });
  $$('.q-text').forEach(el=>{ const id=+el.getAttribute('data-id'); const q=QUESTIONS.find(x=>x.id===id); el.textContent=state.lang==='zh'?q.zh:q.en; });
  // éŸ³ä¹æ–‡æ¡ˆ
  $('#music-label').textContent = `ğŸµ ${dict.music}`;
  $('#music-toggle').textContent = state.music.enabled ? dict.musicOff : dict.musicOn;
  $('#music-vol-label').textContent = dict.volume;
  renderLetterCards();
}
function setLang(lang){ state.lang=lang; document.documentElement.lang=lang==='zh'?'zh':'en'; applyLang(); showToast(lang==='zh'?'å·²åˆ‡æ¢ä¸ºä¸­æ–‡':'Switched to English'); }
function setMotion(mode){
  state.motion=mode;
  if(mode==='reduced' || matchMedia('(prefers-reduced-motion: reduce)').matches){ document.body.classList.add('reduce-motion'); }
  else document.body.classList.remove('reduce-motion');
}

/* ---------- é¢˜ç›®æ¸²æŸ“ ---------- */
function renderQuestions(){
  const byDim={EI:[],SN:[],TF:[],JP:[]};
  QUESTIONS.forEach(q=>byDim[q.dim].push(q));
  Object.keys(byDim).forEach(k=>byDim[k]=shuffle(byDim[k]));
  const interleaved=[]; for(let i=0;i<5;i++) interleaved.push(byDim.EI[i],byDim.SN[i],byDim.TF[i],byDim.JP[i]);
  state.shuffled=interleaved.filter(Boolean);
  const list=$('#q-list'); list.innerHTML='';
  state.shuffled.forEach((q,idx)=>{
    const card=document.createElement('div'); card.className='q-card card';
    card.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <div><span class="k">Q${idx+1}</span> <span class="q-text" data-id="${q.id}">${state.lang==='zh'?q.zh:q.en}</span></div>
        <span class="tag">${q.dim}</span>
      </div>
      <div class="scale" role="group" aria-label="Q${idx+1}">
        ${[1,2,3,4,5].map(v=>`<span class="chip" data-q="${q.id}" data-val="${v}" role="button" tabindex="0">${i18n[state.lang].scale[v]}</span>`).join('')}
      </div>
    `;
    list.appendChild(card);
  });
  $$('.chip').forEach(ch=>{ ch.addEventListener('click',()=>onChoose(ch)); ch.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onChoose(ch);} }); });
  applyLang(); updateProgress();
}
function onChoose(ch){
  const qid=+ch.getAttribute('data-q'); const val=+ch.getAttribute('data-val');
  state.answers[qid]=val; $$(`.chip[data-q="${qid}"]`).forEach(c=>c.setAttribute('data-active','false')); ch.setAttribute('data-active','true'); updateProgress();
}
function updateProgress(){ const answered=Object.keys(state.answers).length; $('#count-ans').textContent=answered; $('#progress').style.width=`${Math.round(answered/20*100)}%`; }

/* ---------- è®¡åˆ† ---------- */
function computeResult(){
  const dims={ EI:{pos:'E',neg:'I',E:[],I:[]}, SN:{pos:'S',neg:'N',S:[],N:[]}, TF:{pos:'T',neg:'F',T:[],F:[]}, JP:{pos:'J',neg:'P',J:[],P:[]} };
  const missing=[];
  QUESTIONS.forEach(q=>{ const v=state.answers[q.id]; if(!v) missing.push(q.id); const delta=(v??3)-3; dims[q.dim][q.side].push({id:q.id,v:(v??3),delta}); });
  if(missing.length) return {error:true,missing};
  const result={letters:[], nets:{}, strengths:{}, tieBreak:false, percents:{}};
  for(const key of ['EI','SN','TF','JP']){
    const d=dims[key], pos=d.pos, neg=d.neg;
    const net=d[pos].reduce((s,x)=>s+x.delta,0) - d[neg].reduce((s,x)=>s+x.delta,0);
    result.nets[key]=net; result.strengths[key]=Math.round(Math.abs(net)/10*100);
    let letter;
    if(net>0) letter=pos; else if(net<0) letter=neg;
    else{
      const mp=avg(d[pos].map(x=>x.v)), mn=avg(d[neg].map(x=>x.v));
      if(mp>mn) letter=pos; else if(mp<mn) letter=neg;
      else{
        const anchor=QUESTIONS.find(q=>q.dim===key && q.anchor); const av=state.answers[anchor.id];
        if(av>3) letter=anchor.side; else if(av<3) letter=(anchor.side===pos?neg:pos); else letter=pos;
      }
      result.tieBreak=true;
    }
    result.letters.push(letter);
    const leftPct=Math.round((net+10)/20*100);
    result.percents[key]={[pos]:leftPct,[neg]:100-leftPct};
  }
  result.code=result.letters.join('');
  return result;
}

/* ---------- ç»“æœæ¸²æŸ“ ---------- */
const TYPE_EMOJIS = { ISTJ:'ğŸ›¡ï¸', ISFJ:'ğŸ«¶', INFJ:'ğŸ”®', INTJ:'â™Ÿï¸', ISTP:'ğŸ› ï¸', ISFP:'ğŸ¨', INFP:'ğŸŒˆ', INTP:'ğŸ§ ', ESTP:'âš¡', ESFP:'ğŸ‰', ENFP:'âœ¨', ENTP:'ğŸš€', ESTJ:'ğŸ“£', ESFJ:'ğŸ¤', ENFJ:'ğŸŒŸ', ENTJ:'ğŸ†' };

function renderResult(){
  const r=state.result; const prof=TYPE_PROFILES[r.code];
  $('#type-code').textContent=r.code;
  $('#type-emoji').textContent = TYPE_EMOJIS[r.code] || prof?.emoji || 'âœ¨';
  const tie=$('#tie-badge'); tie.hidden=!r.tieBreak; tie.textContent=i18n[state.lang].tieBadge;
  $('#name-class').textContent=`${i18n[state.lang].labelName||'å§“å'}: ${state.name} Â· ${i18n[state.lang].labelClass||'ç­çº§'}: ${state.cls}`;
  $('#type-desc').textContent=prof?.desc?.[state.lang]||'';

  // å­—æ¯è§£é‡Š
  renderLetterCards();

  // ç»´åº¦æ¡
  animateBar('#bar-EI', r.percents.EI.E/100, ['#8B77FF','#4DA3FF']);
  animateBar('#bar-SN', r.percents.SN.S/100, ['#4DA3FF','#FFB84D']);
  animateBar('#bar-TF', r.percents.TF.T/100, ['#66E3A4','#FF6B6B']);
  animateBar('#bar-JP', r.percents.JP.J/100, ['#FFB84D','#4DA3FF']);

  // ä»£è¡¨äººç‰©
  const repDiv=$('#rep'); repDiv.innerHTML='';
  (prof?.reps?.[state.lang]||[]).forEach((rp,i)=>{
    const em = ['ğŸ¯','ğŸ¬','ğŸ“–','â­','ğŸ§­'][i%5];
    const card=document.createElement('div'); card.className='rep-card';
    card.innerHTML=`<div class="rep-title"><span class="rep-emoji">${em}</span>${rp.name}</div>
                    <div class="muted" style="margin-top:4px">${rp.why}</div>
                    <div class="rep-quote">â€œ${rp.quote}â€</div>`;
    repDiv.appendChild(card);
  });

  // å»ºè®®/è¯¯åŒº
  const tipsUl=$('#tips'); tipsUl.innerHTML='';
  const pitsUl=$('#pitfalls'); pitsUl.innerHTML='';
  const dictS=SUGGESTIONS[state.lang], dictP=PITFALLS[state.lang];
  const L=r.letters;
  [L[0],L[1],L[2],L[3]].forEach(ch=>{
    (dictS[ch]||[]).forEach(t=>{ const li=document.createElement('li'); li.textContent=t+' âœ…'; tipsUl.appendChild(li); });
    (dictP[ch]||[]).forEach(t=>{ const li=document.createElement('li'); li.textContent='ğŸš« '+t; pitsUl.appendChild(li); });
  });

  if(state.motion!=='reduced' && !matchMedia('(prefers-reduced-motion: reduce)').matches) launchConfetti();
}
function animateBar(sel, ratio, colors){
  const el = document.querySelector(sel);
  el.style.width='0%';
  el.style.background=`linear-gradient(90deg, ${colors[0]}, ${colors[1]})`;
  setTimeout(()=>{ el.style.transition='width 900ms cubic-bezier(.2,.8,.2,1)'; el.style.width = `${Math.max(2, Math.round(ratio*100))}%`; }, 30);
}

/* æ¸²æŸ“â€œå­—æ¯å«ä¹‰â€å¤§å¡ç‰‡ */
function renderLetterCards(){
  const wrap = $('#letters-wrap'); if(!wrap) return;
  wrap.innerHTML='';
  const order = ['E','I','S','N','T','F','J','P'];
  order.forEach((k,i)=>{
    const info = LETTER_INFO[k];
    const card = document.createElement('div');
    card.className='letter-card pop';
    card.style.animationDelay = `${i*0.04}s`;
    const [g1,g2] = LETTER_GRADS[k];
    card.innerHTML = `
      <div class="big-letter" style="background:linear-gradient(180deg,${g1},${g2})">${k}</div>
      <div>
        <div class="lt-title">${info.emoji} ${k} Â· ${info.en} Â· ${info.zh}</div>
        <div class="lt-desc">${info.desc[state.lang]}</div>
      </div>
    `;
    wrap.appendChild(card);
  });
}

/* ---------- å½©å¸¦ ---------- */
function launchConfetti(){
  const canvas=$('#confetti'), ctx=canvas.getContext('2d');
  canvas.width=innerWidth; canvas.height=innerHeight; canvas.classList.remove('hidden');
  const colors=['#4DA3FF','#8B77FF','#FFB84D','#66E3A4','#ffd166','#ff6b6b','#FF6B9A'];
  const pieces=Array.from({length:140}).map(()=>({x:Math.random()*canvas.width,y:-20-Math.random()*canvas.height/2,w:6+Math.random()*6,h:10+Math.random()*10,c:colors[Math.floor(Math.random()*colors.length)],vY:2+Math.random()*3,vX:-1+Math.random()*2,rot:Math.random()*Math.PI,vr:-0.1+Math.random()*0.2}));
  let t=0,maxT=1800;
  function frame(){
    t+=16; ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{ p.x+=p.vX; p.y+=p.vY; p.rot+=p.vr; if(p.y>canvas.height+30){p.y=-20; p.x=Math.random()*canvas.width;} ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.c; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); });
    if(t<maxT && state.motion!=='reduced') requestAnimationFrame(frame); else canvas.classList.add('hidden');
  }
  requestAnimationFrame(frame);
}

/* ---------- åˆ†äº«å›¾ç‰‡ï¼ˆä¸å«äºŒç»´ç ï¼‰ ---------- */
$('#btn-share').addEventListener('click', ()=>{
  const r=state.result, W=900, H=1300;
  const canvas=$('#share-canvas'), ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const grad=ctx.createLinearGradient(0,0,0,H); grad.addColorStop(0,'#f6f8ff'); grad.addColorStop(1,'#fefaf5'); ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);

  ctx.fillStyle='#2f2f33'; ctx.font='bold 40px system-ui';
  ctx.fillText(i18n[state.lang].shareTitle, 40, 70);
  ctx.font='28px system-ui';
  ctx.fillText(`${i18n[state.lang].labelName}: ${state.name}`, 40, 120);
  ctx.fillText(`${i18n[state.lang].labelClass}: ${state.cls}`, 40, 160);

  ctx.font='bold 80px system-ui'; ctx.fillStyle='#8B77FF';
  const emoji = TYPE_EMOJIS[r.code] || 'âœ¨';
  ctx.fillText(`${emoji}  ${r.code}`, 40, 250);

  const bars=[
    {lab:'E / I', p:r.percents.EI.E, colors:['#8B77FF','#4DA3FF']},
    {lab:'S / N', p:r.percents.SN.S, colors:['#4DA3FF','#FFB84D']},
    {lab:'T / F', p:r.percents.TF.T, colors:['#66E3A4','#FF6B6B']},
    {lab:'J / P', p:r.percents.JP.J, colors:['#FFB84D','#4DA3FF']}
  ];
  ctx.fillStyle='#2f2f33'; ctx.font='20px system-ui';
  let y=320; bars.forEach(b=>{ ctx.fillText(b.lab,40,y); drawBar(ctx,120,y-14, 600,18, b.p/100, b.colors[0], b.colors[1]); y+=60; });

  ctx.font='24px system-ui'; ctx.fillStyle='#2f2f33';
  const desc=(TYPE_PROFILES[r.code]?.desc?.[state.lang])||''; drawMultiline(ctx, desc, 40, y, 820, 30); y+=120;

  ctx.font='bold 24px system-ui'; ctx.fillText(i18n[state.lang].representatives, 40, y); y+=36;
  ctx.font='20px system-ui';
  const reps=(TYPE_PROFILES[r.code]?.reps?.[state.lang]||[]).slice(0,2);
  reps.forEach((rep,i)=>{ const t=`â€¢ ${rep.name} â€”â€” ${rep.why}ï½œâ€œ${rep.quote}â€`; drawMultiline(ctx, t, 40, y+i*32, 820, 28); });

  ctx.font='16px system-ui'; ctx.fillStyle='#6b6f76';
  ctx.fillText(i18n[state.lang].shareFooter, 40, H-60);

  canvas.classList.remove('hidden');
  const url=canvas.toDataURL('image/png');
  const a=document.createElement('a'); a.href=url; a.download=`MBTI_${state.name}_${r.code}.png`; document.body.appendChild(a); a.click(); setTimeout(()=>a.remove(),0);
  showToast(state.lang==='zh'?'å·²ä¸‹è½½å›¾ç‰‡':'Image downloaded');
});
function drawBar(ctx,x,y,w,h,ratio,c1,c2){
  ctx.fillStyle='rgba(0,0,0,0.08)'; roundRect(ctx,x,y,w,h,9); ctx.fill();
  const gw=Math.max(2,Math.round(w*ratio)); const grad=ctx.createLinearGradient(x,0,x+w,0); grad.addColorStop(0,c1); grad.addColorStop(1,c2);
  ctx.fillStyle=grad; roundRect(ctx,x,y,gw,h,9); ctx.fill();
}
function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
function drawMultiline(ctx,text,x,y,maxW,lineH){ const chars=text.split(''); let line='',yy=y; chars.forEach(ch=>{ const t=line+ch; if(ctx.measureText(t).width>maxW){ ctx.fillText(line,x,yy); yy+=lineH; line=ch; } else line=t; }); if(line) ctx.fillText(line,x,yy); }

/* ---------- é¡µé¢åˆ‡æ¢ ---------- */
function show(sectionId){ ['intro','quiz','result'].forEach(id=>$('#'+id).classList.add('hidden')); $('#'+sectionId).classList.remove('hidden'); scrollTo({top:0,behavior:'smooth'}); }

/* ---------- äº‹ä»¶ ---------- */
function validateInfo(){
  state.name=$('#inp-name').value.trim(); state.cls=$('#inp-class').value.trim();
  if(!state.name){ showToast(state.lang==='zh'?'è¯·å¡«å†™å§“å':'Please enter your name'); return false; }
  if(!state.cls){ showToast(state.lang==='zh'?'è¯·å¡«å†™ç­çº§':'Please enter your class'); return false; }
  return true;
}
$('#btn-start').addEventListener('click', ()=>{ if(!validateInfo()) return; renderQuestions(); show('quiz'); });
$('#btn-scrollTop').addEventListener('click', ()=>scrollTo({top:0,behavior:'smooth'}));
$('#btn-jumpUnanswered').addEventListener('click', ()=>{
  for(const q of state.shuffled){ if(!state.answers[q.id]){ const el=$$(`.chip[data-q="${q.id}"]`)[0]; el?.scrollIntoView({behavior:'smooth',block:'center'}); el?.focus(); return; } }
  showToast(state.lang==='zh'?'å·²å…¨éƒ¨ä½œç­”':'All answered');
});
$('#btn-submit').addEventListener('click', ()=>{
  const res=computeResult(); if(res.error){ showToast(state.lang==='zh'?'è¿˜æœ‰æœªç­”é¢˜ç›®':'Some questions are unanswered'); return; }
  state.result=res; state.tieBreakUsed=!!res.tieBreak; renderResult(); show('result');
});
$('#btn-retake').addEventListener('click', ()=>{ state.answers={}; renderQuestions(); show('quiz'); });

/* ---------- è¯­è¨€&åŠ¨æ•ˆæŒ‰é’® ---------- */
$('#lang-zh').addEventListener('click', ()=>setLang('zh'));
$('#lang-en').addEventListener('click', ()=>setLang('en'));
$('#motion-standard').addEventListener('click', ()=>{ setMotion('standard'); showToast(state.lang==='zh'?'å·²åˆ‡æ¢æ ‡å‡†åŠ¨æ•ˆ':'Standard motion on'); });
$('#motion-reduced').addEventListener('click', ()=>{ setMotion('reduced'); showToast(state.lang==='zh'?'å·²åˆ‡æ¢å¼±åŠ¨æ•ˆ':'Reduced motion on'); });

/* ---------- èƒŒæ™¯éŸ³ä¹æ§åˆ¶ï¼ˆä½¿ç”¨ä½ æä¾›çš„éŸ³é¢‘ï¼‰ ---------- */
const audioEl = document.getElementById('bgm-audio');
const musicToggle = document.getElementById('music-toggle');
const musicVol = document.getElementById('music-vol');

function updateMusicTexts(){
  const dict=i18n[state.lang];
  musicToggle.textContent = state.music.enabled ? dict.musicOff : dict.musicOn;
}
async function toggleMusic(){
  state.music.enabled = !state.music.enabled;
  try{
    if(state.music.enabled){
      audioEl.volume = state.music.volume;
      await audioEl.play();
    }else{
      audioEl.pause();
    }
    updateMusicTexts();
    showToast(state.lang==='zh'?(state.music.enabled?'éŸ³ä¹å·²å¼€å¯':'éŸ³ä¹å·²å…³é—­'):(state.music.enabled?'Music on':'Music off'));
  }catch(e){
    state.music.enabled=false; updateMusicTexts();
    console.warn(e);
    showToast(state.lang==='zh'?'æ’­æ”¾è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¯·å†ç‚¹ä¸€æ¬¡â€œå¼€å¯â€':'Autoplay blocked, tap On again');
  }
}
musicToggle.addEventListener('click', toggleMusic);
musicVol.addEventListener('input', ()=>{
  const v = Math.max(0, Math.min(1, musicVol.value/100));
  state.music.volume = v; audioEl.volume = v;
});

/* ---------- åˆå§‹åŒ– ---------- */
(function init(){
  setLang('zh');
  if(matchMedia('(prefers-reduced-motion: reduce)').matches){ setMotion('reduced'); } else setMotion('standard');
  // åˆå§‹åŒ–éŸ³ä¹UI
  musicVol.value = Math.round(state.music.volume*100);
  audioEl.volume = state.music.volume;
  updateMusicTexts();
})();
</script>
</body>
</html>