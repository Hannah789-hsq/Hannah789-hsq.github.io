<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„mojiï¼šä¸ƒä¸‹è¯—è¯æ„è±¡é…å¯¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#4CAF50',
                        accent: '#E57373',
                    },
                    fontFamily: {
                        'dancing': ['Dancing Script', 'cursive'],
                        'chinese': ['STKaiti', 'KaiTi', 'SimKai', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Dancing+Script:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .game-title {
            background: linear-gradient(45deg, #8B4513, #D2691E);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-right: 8px;
        }
        
        .emoji-title {
            font-family: 'Dancing Script', cursive;
            font-weight: 700;
            font-size: 1.8rem;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .emoji-card {
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .emoji-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .emoji-card.selected {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            transform: scale(1.05);
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: inline-block;
            margin: 0 6px;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #5D5CDE, #667eea);
            transform: scale(1.2);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .correct-animation {
            animation: pulse 0.6s ease-in-out;
        }
        
        .card-style-classic {
            background: linear-gradient(135deg, #f4f1e8 0%, #e8dcc0 100%);
            border: 2px solid #8B4513;
        }
        
        .card-style-ink {
            background: linear-gradient(135deg, #f8f8f8 0%, #e0e0e0 100%);
            border: 2px solid #333;
        }
        
        .card-style-elegant {
            background: linear-gradient(135deg, #fff 0%, #f0f8ff 100%);
            border: 2px solid #4682b4;
        }
        
        .card-style-sunset {
            background: linear-gradient(135deg, #ffe4e1 0%, #ffd4c4 100%);
            border: 2px solid #cd853f;
        }
        
        .card-style-bamboo {
            background: linear-gradient(135deg, #f0fff0 0%, #e6ffe6 100%);
            border: 2px solid #228b22;
        }
        
        .card-style-dark {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            border: 2px solid #8b7355;
            color: #f0f0f0;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- å¤´éƒ¨ -->
        <div class="flex justify-center items-center mb-4">
            <span class="game-title">æ„</span>
            <span class="emoji-title">emoji</span>
            <span class="text-gray-600 ml-2">ä¸ƒä¸‹è¯—è¯æ„è±¡é…å¯¹</span>
        </div>

        <!-- è¿›åº¦æŒ‡ç¤ºå™¨å’Œå€’è®¡æ—¶ -->
        <div class="flex justify-between items-center mb-3">
            <div class="progress-container flex space-x-2">
                <div id="progress-text" class="text-sm text-primary mr-2">å‰©ä½™æœºä¼šï¼š3</div>
                <div id="progress-dots" class="flex">
                    <!-- è¿›åº¦ç‚¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            <div id="current-score" class="text-sm font-medium text-primary">å¾—åˆ†ï¼š0</div>
        </div>
        
        <!-- å€’è®¡æ—¶ -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-1">
                <span class="text-sm font-medium text-gray-700">æ—¶é—´å‰©ä½™ï¼š<span id="countdown-text">20</span>ç§’</span>
                <span id="countdown-warning" class="text-xs text-red-500 hidden">æ—¶é—´å³å°†ç»“æŸï¼</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 shadow-inner">
                <div id="countdown-bar" class="bg-gradient-to-r from-primary to-purple-400 h-3 rounded-full transition-all duration-1000" style="width: 100%"></div>
            </div>
        </div>

        <!-- è¯—æ­Œå±•ç¤º -->
        <div class="bg-white rounded-xl p-6 mb-6 border-2 border-primary relative shadow-lg">
            <div class="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-primary -mt-1 -ml-1 rounded-tl-lg"></div>
            <div class="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-primary -mb-1 -mr-1 rounded-br-lg"></div>
            <p id="poem-text" class="text-lg text-center mb-3 leading-relaxed text-gray-800"></p>
            <p id="poem-source" class="text-sm text-gray-600 text-center font-medium"></p>
        </div>

        <!-- Emojié€‰æ‹©ç½‘æ ¼ -->
        <div id="emoji-grid" class="grid grid-cols-3 gap-4 mb-6">
            <!-- Emojiå¡ç‰‡ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- æŒ‰é’®åŒºåŸŸ -->
        <div class="flex space-x-4 mb-6">
            <button id="generate-card" class="flex-1 bg-gradient-to-r from-primary to-purple-400 text-white py-3 px-4 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed shadow-lg transform transition-all duration-200 hover:scale-105">
                ğŸ¨ åˆ¶ä½œå£çº¸
            </button>
            <button id="next-poem" class="flex-1 bg-gradient-to-r from-green-400 to-blue-400 text-white py-3 px-4 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed shadow-lg transform transition-all duration-200 hover:scale-105">
                ä¸‹ä¸€é¦– â†’
            </button>
        </div>

        <!-- è§£é‡ŠåŒºåŸŸ -->
        <div id="explanation" class="bg-gradient-to-r from-indigo-100 to-purple-100 border-l-4 border-primary p-4 rounded-lg mb-6 hidden shadow-md">
            <p id="explanation-text" class="text-sm text-gray-700 leading-relaxed"></p>
        </div>

        <!-- æ¸¸æˆç»Ÿè®¡ -->
        <div class="flex justify-between text-sm text-gray-600 border-t border-gray-200 pt-4">
            <div>
                <span class="font-medium">æœ€é«˜è¿å‡»</span>
                <span id="max-combo" class="ml-2 text-primary font-bold">0</span>
            </div>
            <div>
                <span class="font-medium">å¹³å‡æ—¶é—´</span>
                <span id="avg-time" class="ml-2 text-primary font-bold">0s</span>
            </div>
            <div>
                <span class="font-medium">è¯¦æƒ…</span>
                <span class="ml-2">â„¹ï¸</span>
            </div>
        </div>

        <!-- å£çº¸åˆ¶ä½œæ¨¡æ€æ¡† -->
        <div id="card-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-screen overflow-y-auto">
                <!-- æ ‡é¢˜ -->
                <div class="p-4 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-center flex items-center justify-center">
                        <span class="game-title mr-2">æ„</span>
                        <span class="emoji-title mr-2">emoji</span>
                        <span class="text-gray-600">å£çº¸åˆ¶ä½œ</span>
                    </h2>
                </div>
                
                <!-- é£æ ¼é€‰æ‹© -->
                <div class="p-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">é€‰æ‹©é£æ ¼</h3>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button class="style-btn card-style-classic p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="classic">
                            <div class="text-lg mb-1">ğŸ“œ</div>
                            å…¸é›…å¤é£
                        </button>
                        <button class="style-btn card-style-ink p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="ink">
                            <div class="text-lg mb-1">ğŸ–‹ï¸</div>
                            æ°´å¢¨é£éŸµ
                        </button>
                        <button class="style-btn card-style-elegant p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="elegant">
                            <div class="text-lg mb-1">â˜ï¸</div>
                            æ¸…é›…ç»å°˜
                        </button>
                        <button class="style-btn card-style-sunset p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="sunset">
                            <div class="text-lg mb-1">ğŸŒ…</div>
                            è½éœé£é›
                        </button>
                        <button class="style-btn card-style-bamboo p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="bamboo">
                            <div class="text-lg mb-1">ğŸ‹</div>
                            é’ç«¹å¦‚èŒµ
                        </button>
                        <button class="style-btn card-style-dark p-3 rounded-lg border-2 text-center text-sm font-medium transition-all" data-style="dark">
                            <div class="text-lg mb-1">ğŸŒƒ</div>
                            å¢¨éŸµæµèŠ³
                        </button>
                    </div>
                </div>
                
                <!-- é¢„è§ˆåŒº -->
                <div class="p-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">é¢„è§ˆæ•ˆæœ (9:16)</h3>
                    <div id="wallpaper-preview" class="mx-auto bg-white rounded-lg shadow-lg overflow-hidden" style="width: 180px; height: 320px; transform: scale(0.8); transform-origin: top;">
                        <div id="wallpaper-content" class="card-style-classic w-full h-full relative p-4 flex flex-col justify-between" style="width: 180px; height: 320px;">
                            <!-- è£…é¥°è¾¹æ¡† -->
                            <div class="absolute top-2 left-2 w-4 h-4 border-t-2 border-l-2" style="border-color: inherit;"></div>
                            <div class="absolute top-2 right-2 w-4 h-4 border-t-2 border-r-2" style="border-color: inherit;"></div>
                            <div class="absolute bottom-2 left-2 w-4 h-4 border-b-2 border-l-2" style="border-color: inherit;"></div>
                            <div class="absolute bottom-2 right-2 w-4 h-4 border-b-2 border-r-2" style="border-color: inherit;"></div>
                            
                            <!-- è¯—æ­Œå†…å®¹åŒºåŸŸ -->
                            <div class="flex-1 flex justify-center items-center">
                                <!-- ä¸¤åˆ—è¯—å¥å¸ƒå±€ -->
                                <div id="preview-poem" class="flex justify-center space-x-4 text-sm leading-relaxed font-chinese h-full items-center"></div>
                            </div>
                            
                            <!-- åº•éƒ¨ä¿¡æ¯ -->
                            <div class="absolute bottom-4 left-4">
                                <!-- ä½œè€…ä¿¡æ¯ï¼ˆç«–æ’åœ¨å·¦ä¸‹è§’ï¼‰ -->
                                <div id="preview-source" class="text-xs text-gray-600 font-chinese"></div>
                            </div>
                            
                            <!-- å“ç‰Œæ ‡è¯†ï¼ˆå³ä¸‹è§’ï¼‰ -->
                            <div class="absolute bottom-4 right-4">
                                <div class="bg-red-800 text-white px-2 py-1 text-xs rounded">
                                    <span class="game-title text-xs">æ„</span><span class="emoji-title text-xs">emoji</span>
                                </div>
                            </div>
                            
                            <!-- éšè—çš„emojiåŒºåŸŸ -->
                            <div id="preview-emojis" style="display: none;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="p-4 border-t border-gray-200">
                    <div class="flex space-x-3">
                        <button id="close-modal" class="flex-1 bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-medium hover:bg-gray-200 transition-colors">
                            å–æ¶ˆ
                        </button>
                        <button id="download-wallpaper" class="flex-1 bg-gradient-to-r from-primary to-purple-400 text-white py-3 px-4 rounded-xl font-medium hover:from-purple-500 hover:to-primary transition-all">
                            ğŸ“± ä¸‹è½½å£çº¸
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        // æ¸¸æˆæ•°æ®
        const poems = [
            {
                text: "è°å®¶ç‰ç¬›æš—é£å£°ï¼Œæ•£å…¥æ˜¥é£æ»¡æ´›åŸã€‚\næ­¤å¤œæ›²ä¸­é—»æŠ˜æŸ³ï¼Œä½•äººä¸èµ·æ•…å›­æƒ…ã€‚",
                source: "æ˜¥å¤œæ´›åŸé—»ç¬›Â·æç™½",
                correctEmojis: [
                    { emoji: "ğŸµ", meaning: "ç‰ç¬›/ç¬›å£°" },
                    { emoji: "ğŸƒ", meaning: "æ˜¥é£" },
                    { emoji: "ğŸ™ï¸", meaning: "æ´›åŸ/åŸå¸‚" },
                    { emoji: "ğŸ¡", meaning: "æ•…å›­/æ€ä¹¡" }
                ],
                explanation: "è¿™é¦–è¯—æç»˜äº†æ˜¥å¤œé‡Œç¬›å£°åœ¨æ´›é˜³åŸä¸­é£˜è¡çš„åœºæ™¯ï¼Œå¼•å‘äº†è¯—äººçš„æ€ä¹¡ä¹‹æƒ…ã€‚æ„è±¡åŒ…æ‹¬ç‰ç¬›(ğŸµ)ã€æ˜¥é£(ğŸƒ)ã€æ´›åŸ(ğŸ™ï¸)å’Œæ€ä¹¡ä¹‹æƒ…(ğŸ¡)ã€‚"
            },
            {
                text: "è‰æ ‘çŸ¥æ˜¥ä¸ä¹…å½’ï¼Œç™¾èˆ¬çº¢ç´«æ–—èŠ³è²ã€‚\næ¨èŠ±æ¦†èšæ— æ‰æ€ï¼ŒæƒŸè§£æ¼«å¤©ä½œé›ªé£ã€‚",
                source: "æ™šæ˜¥Â·éŸ©æ„ˆ",
                correctEmojis: [
                    { emoji: "ğŸŒ¿", meaning: "è‰æ ‘/æ¤ç‰©" },
                    { emoji: "ğŸŒ¸", meaning: "èŠ±æœµ/èŠ³è²" },
                    { emoji: "ğŸŒ±", meaning: "æ¨èŠ±/æ¦†èš" },
                    { emoji: "â„ï¸", meaning: "é£˜é›ª/æ¼«å¤©é£èˆ" }
                ],
                explanation: "è¿™é¦–è¯—æç»˜äº†æ™šæ˜¥æ—¶èŠ‚çš„æ™¯è±¡ï¼Œå„ç§èŠ±å‰äº‰å¥‡æ–—è‰³ï¼Œè€Œæ¨èŠ±å’Œæ¦†èšè™½æ— æ‰æƒ…å´æ¼«å¤©é£èˆå¦‚é›ªã€‚æ„è±¡åŒ…æ‹¬è‰æ ‘(ğŸŒ¿)ã€èŠ±æœµ(ğŸŒ¸)ã€æ¨èŠ±æ¦†èš(ğŸŒ±)å’Œé£˜é›ª(â„ï¸)ã€‚"
            },
            {
                text: "é»„æ¢…æ—¶èŠ‚å®¶å®¶é›¨ï¼Œé’è‰æ± å¡˜å¤„å¤„è›™ã€‚\næœ‰çº¦ä¸æ¥è¿‡å¤œåŠï¼Œé—²æ•²æ£‹å­è½ç¯èŠ±ã€‚",
                source: "çº¦å®¢Â·èµµå¸ˆç§€",
                correctEmojis: [
                    { emoji: "ğŸŒ§ï¸", meaning: "æ¢…é›¨/é›¨æ°´" },
                    { emoji: "ğŸ¸", meaning: "é’è›™/è›™å£°" },
                    { emoji: "â™Ÿï¸", meaning: "æ£‹å­" },
                    { emoji: "ğŸ•¯ï¸", meaning: "ç¯èŠ±/ç¯çƒ›" }
                ],
                explanation: "è¿™é¦–è¯—æå†™äº†æ¢…é›¨å­£èŠ‚ç­‰å¾…å‹äººä¸è‡³çš„æƒ…æ™¯ã€‚æ„è±¡åŒ…æ‹¬æ¢…é›¨(ğŸŒ§ï¸)ã€é’è›™(ğŸ¸)ã€æ£‹å­(â™Ÿï¸)å’Œç¯èŠ±(ğŸ•¯ï¸)ï¼Œè¡¨è¾¾äº†è¯—äººçš„å­¤ç‹¬å’ŒæœŸå¾…ã€‚"
            },
            {
                text: "æ•…å›­ä¸œæœ›è·¯æ¼«æ¼«ï¼ŒåŒè¢–é¾™é’Ÿæ³ªä¸å¹²ã€‚\né©¬ä¸Šç›¸é€¢æ— çº¸ç¬”ï¼Œå‡­å›ä¼ è¯­æŠ¥å¹³å®‰ã€‚",
                source: "é€¢å…¥äº¬ä½¿Â·å²‘å‚",
                correctEmojis: [
                    { emoji: "ğŸ¡", meaning: "æ•…ä¹¡/æ•…å›­" },
                    { emoji: "ğŸ˜¢", meaning: "æ³ªæ°´/æ€å¿µ" },
                    { emoji: "ğŸ", meaning: "é©¬åŒ¹/æ—…é€”" },
                    { emoji: "ğŸ’Œ", meaning: "ä¿¡æ¯/ä¼ è¯­" }
                ],
                explanation: "è¿™é¦–è¯—æè¿°äº†è¯—äººåœ¨å¼‚ä¹¡é‡åˆ°è¿›äº¬ä½¿è€…çš„æƒ…æ™¯ï¼Œè¡¨è¾¾äº†å¯¹å®¶ä¹¡çš„æ€å¿µä¹‹æƒ…ã€‚æ„è±¡åŒ…æ‹¬æ•…å›­(ğŸ¡)ã€æ³ªæ°´(ğŸ˜¢)ã€é©¬åŒ¹(ğŸ)å’Œä¼ ä¿¡(ğŸ’Œ)ã€‚"
            },
            {
                text: "æµ©è¡ç¦»æ„ç™½æ—¥æ–œï¼ŒåŸé­ä¸œæŒ‡å³å¤©æ¶¯ã€‚\nè½çº¢ä¸æ˜¯æ— æƒ…ç‰©ï¼ŒåŒ–ä½œæ˜¥æ³¥æ›´æŠ¤èŠ±ã€‚",
                source: "å·±äº¥æ‚è¯—Â·é¾šè‡ªç",
                correctEmojis: [
                    { emoji: "ğŸŒ‡", meaning: "å¤•é˜³/ç™½æ—¥æ–œ" },
                    { emoji: "ğŸ§³", meaning: "è¿œè¡Œ/å¤©æ¶¯" },
                    { emoji: "ğŸ¥€", meaning: "è½èŠ±/è½çº¢" },
                    { emoji: "ğŸŒ±", meaning: "æ˜¥æ³¥/åœŸå£¤" }
                ],
                explanation: "è¿™é¦–è¯—è¡¨è¾¾äº†è¯—äººç¦»æ„å’Œå¯¹æœªæ¥çš„å±•æœ›ã€‚æœ€åä¸¤å¥è½çº¢ä¸æ˜¯æ— æƒ…ç‰©ï¼ŒåŒ–ä½œæ˜¥æ³¥æ›´æŠ¤èŠ±å°¤ä¸ºè‘—åã€‚æ„è±¡åŒ…æ‹¬å¤•é˜³(ğŸŒ‡)ã€è¿œè¡Œ(ğŸ§³)ã€è½èŠ±(ğŸ¥€)å’Œæ˜¥æ³¥(ğŸŒ±)ã€‚"
            },
            {
                text: "è«ç¬‘å†œå®¶è…Šé…’æµ‘ï¼Œä¸°å¹´ç•™å®¢è¶³é¸¡è±šã€‚\nå±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘ã€‚",
                source: "æ¸¸å±±è¥¿æ‘Â·é™†æ¸¸",
                correctEmojis: [
                    { emoji: "ğŸ˜ï¸", meaning: "å†œå®¶/æ‘åº„" },
                    { emoji: "ğŸï¸", meaning: "å±±æ°´/å±±è·¯" },
                    { emoji: "ğŸŒ³", meaning: "æŸ³æ ‘" },
                    { emoji: "ğŸŒ¸", meaning: "èŠ±æœµ/æ˜äº®" }
                ],
                explanation: "è¿™é¦–è¯—æç»˜äº†è¯—äººæ¸¸è§ˆå±±æ‘çš„æƒ…æ™¯ï¼Œå…¶ä¸­å±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘æˆä¸ºäº†åƒå¤åå¥ã€‚æ„è±¡åŒ…æ‹¬å†œå®¶(ğŸ˜ï¸)ã€å±±æ°´(ğŸï¸)ã€æŸ³æ ‘(ğŸŒ³)å’ŒèŠ±æœµ(ğŸŒ¸)ã€‚"
            },
            {
                text: "ç»¿æ§é«˜æŸ³å’½æ–°è‰ã€‚è–°é£åˆå…¥å¼¦ã€‚\nç¢§çº±çª—ä¸‹æ°´æ²ˆçƒŸã€‚æ£‹å£°æƒŠæ˜¼çœ ã€‚",
                source: "é˜®éƒå½’ åˆå¤Â·è‹è½¼",
                correctEmojis: [
                    { emoji: "ğŸ¦—", meaning: "è‰/è‰é¸£" },
                    { emoji: "ğŸƒ", meaning: "å¾®é£/è–°é£" },
                    { emoji: "â™Ÿï¸", meaning: "ä¸‹æ£‹/æ£‹å£°" },
                    { emoji: "ğŸ˜´", meaning: "æ˜¼çœ /åˆç¡" }
                ],
                explanation: "è¿™é¦–è¯æç»˜äº†åˆå¤æ—¶èŠ‚çš„æ™¯è±¡ï¼ŒåŒ…æ‹¬è‰é¸£(ğŸ¦—)ã€è–°é£(ğŸƒ)ã€æ£‹å£°(â™Ÿï¸)å’Œæ˜¼çœ (ğŸ˜´)ï¼Œè¥é€ å‡ºä¸€ç§æ‚ é—²æ¬é™çš„åˆå¤æ°›å›´ã€‚"
            },
            {
                text: "æ¢…å­é‡‘é»„æå­è‚¥ï¼Œéº¦èŠ±é›ªç™½èœèŠ±ç¨€ã€‚\næ—¥é•¿ç¯±è½æ— äººè¿‡ï¼ŒæƒŸæœ‰èœ»èœ“è›±è¶é£ã€‚",
                source: "å¤æ—¥ç”°å›­æ‚å…´åäºŒç»ï¼ˆå…¶ä¸€ï¼‰Â·èŒƒæˆå¤§",
                correctEmojis: [
                    { emoji: "ğŸ‘", meaning: "æœå®/æ¢…æ" },
                    { emoji: "ğŸŒ¾", meaning: "éº¦èŠ±/èœèŠ±" },
                    { emoji: "ğŸŒ„", meaning: "ç¯±ç¬†/ç”°å›­" },
                    { emoji: "ğŸ¦‹", meaning: "èœ»èœ“/è´è¶" }
                ],
                explanation: "è¿™é¦–è¯—æç»˜äº†å¤æ—¥ç”°å›­çš„é™è°§æ™¯è±¡ï¼Œæˆç†Ÿçš„æœå®ã€ç››å¼€çš„èŠ±æœµå’Œé£èˆçš„æ˜†è™«æ„æˆäº†ä¸€å¹…ç”ŸåŠ¨çš„ä¹¡æ‘å›¾æ™¯ã€‚æ„è±¡åŒ…æ‹¬æœå®(ğŸ‘)ã€éº¦èŠ±(ğŸŒ¾)ã€ç”°å›­(ğŸŒ„)å’Œèœ»èœ“è´è¶(ğŸ¦‹)ã€‚"
            },
            {
                text: "ç‹¬åå¹½ç¯é‡Œï¼Œå¼¹ç´å¤é•¿å•¸ã€‚\næ·±æ—äººä¸çŸ¥ï¼Œæ˜æœˆæ¥ç›¸ç…§ã€‚",
                source: "ç«¹é‡Œé¦†Â·ç‹ç»´",
                correctEmojis: [
                    { emoji: "ğŸ‹", meaning: "ç«¹æ—/å¹½ç¯" },
                    { emoji: "ğŸ»", meaning: "ç´/éŸ³ä¹" },
                    { emoji: "ğŸŒ²", meaning: "æ·±æ—/ç‹¬å¤„" },
                    { emoji: "ğŸŒ•", meaning: "æ˜æœˆ" }
                ],
                explanation: "è¿™é¦–è¯—æè¿°äº†è¯—äººç‹¬è‡ªåœ¨ç«¹æ—ä¸­å¼¹ç´é•¿å•¸ï¼Œä¸è‡ªç„¶èä¸ºä¸€ä½“çš„æ„å¢ƒã€‚æ„è±¡åŒ…æ‹¬ç«¹æ—(ğŸ‹)ã€ç´å£°(ğŸ»)ã€æ·±æ—(ğŸŒ²)å’Œæ˜æœˆ(ğŸŒ•)ï¼Œè¡¨è¾¾äº†è¯—äººéšé€¸çš„å¿ƒå¢ƒã€‚"
            },
            {
                text: "çƒŸç¬¼å¯’æ°´æœˆç¬¼æ²™ï¼Œå¤œæ³Šç§¦æ·®è¿‘é…’å®¶ã€‚\nå•†å¥³ä¸çŸ¥äº¡å›½æ¨ï¼Œéš”æ±ŸçŠ¹å”±ååº­èŠ±ã€‚",
                source: "æ³Šç§¦æ·®Â·æœç‰§",
                correctEmojis: [
                    { emoji: "ğŸŒ«ï¸", meaning: "æ°´é›¾/çƒŸç¬¼" },
                    { emoji: "ğŸŒ™", meaning: "æœˆå…‰/æœˆè‰²" },
                    { emoji: "ğŸš£", meaning: "èˆ¹åª/å¤œæ³Š" },
                    { emoji: "ğŸµ", meaning: "æ­Œå£°/å”±æ›²" }
                ],
                explanation: "è¿™é¦–è¯—æç»˜äº†è¯—äººå¤œæ³Šç§¦æ·®æ²³ç•”çš„æ‰€è§æ‰€æ„Ÿï¼Œè¡¨è¾¾äº†å¯¹å›½å®¶å‘½è¿çš„å¿§æ€ã€‚æ„è±¡åŒ…æ‹¬æ°´é›¾(ğŸŒ«ï¸)ã€æœˆå…‰(ğŸŒ™)ã€èˆ¹åª(ğŸš£)å’Œæ­Œå£°(ğŸµ)ã€‚"
            },
            {
                text: "é£æ¥å±±ä¸Šåƒå¯»å¡”ï¼Œé—»è¯´é¸¡é¸£è§æ—¥å‡ã€‚\nä¸ç•æµ®äº‘é®æœ›çœ¼ï¼Œè‡ªç¼˜èº«åœ¨æœ€é«˜å±‚ã€‚",
                source: "ç™»é£æ¥å³°Â·ç‹å®‰çŸ³",
                correctEmojis: [
                    { emoji: "ğŸ”ï¸", meaning: "é«˜å±±/å³°é¡¶" },
                    { emoji: "ğŸ—¼", meaning: "å¡”æ¥¼/åƒå¯»å¡”" },
                    { emoji: "ğŸŒ…", meaning: "æ—¥å‡º/æ—¥å‡" },
                    { emoji: "â˜ï¸", meaning: "æµ®äº‘" }
                ],
                explanation: "è¿™é¦–è¯—æè¿°äº†è¯—äººç™»ä¸Šé£æ¥å³°ä¿¯ç°å¤§åœ°çš„æƒ…æ™¯ï¼Œè¡¨è¾¾äº†ä¸€ç§é«˜ç»è¿œç©çš„èƒ¸æ€€ã€‚æ„è±¡åŒ…æ‹¬é«˜å±±(ğŸ”ï¸)ã€å¡”æ¥¼(ğŸ—¼)ã€æ—¥å‡º(ğŸŒ…)å’Œæµ®äº‘(â˜ï¸)ã€‚"
            },
            {
                text: "å®£å®¤æ±‚è´¤è®¿é€è‡£ï¼Œè´¾ç”Ÿæ‰è°ƒæ›´æ— ä¼¦ã€‚\nå¯æ€œå¤œåŠè™šå‰å¸­ï¼Œä¸é—®è‹ç”Ÿé—®é¬¼ç¥ã€‚",
                source: "è´¾ç”ŸÂ·æå•†éš",
                correctEmojis: [
                    { emoji: "ğŸ›ï¸", meaning: "å®«æ®¿/å®£å®¤" },
                    { emoji: "ğŸŒƒ", meaning: "å¤œæ™š/å¤œåŠ" },
                    { emoji: "ğŸ‘»", meaning: "é¬¼ç¥/è¿·ä¿¡" }
                ],
                explanation: "è¿™é¦–è¯—é€šè¿‡è´¾è°Šçš„æ•…äº‹ï¼Œæ‰¹è¯„äº†ç»Ÿæ²»è€…ä¸é‡è§†è´¤æ‰ã€è¿·ä¿¡é¬¼ç¥çš„è¡Œä¸ºã€‚æ„è±¡åŒ…æ‹¬å®«æ®¿(ğŸ›ï¸)ã€å¤œæ™š(ğŸŒƒ)å’Œé¬¼ç¥(ğŸ‘»)ã€‚"
            },
            {
                text: "è«è¨€ä¸‹å²­ä¾¿æ— éš¾ï¼Œèµšå¾—è¡Œäººé”™å–œæ¬¢ã€‚\næ”¿å…¥ä¸‡å±±å›´å­é‡Œï¼Œä¸€å±±æ”¾å‡ºä¸€å±±æ‹¦ã€‚",
                source: "è¿‡æ¾æºæ™¨ç‚Šæ¼†å…¬åº—ï¼ˆå…¶äº”ï¼‰Â·æ¨ä¸‡é‡Œ",
                correctEmojis: [
                    { emoji: "â›°ï¸", meaning: "å±±å²­/ä¸‹å²­" },
                    { emoji: "ğŸš¶", meaning: "æ—…äºº/è¡Œäºº" },
                    { emoji: "ğŸï¸", meaning: "å±±è·¯/å±±å›´" },
                    { emoji: "ğŸš§", meaning: "éšœç¢/æ‹¦é˜»" }
                ],
                explanation: "è¿™é¦–è¯—æè¿°äº†ç¿»å±±è¶Šå²­çš„è‰°éš¾å†ç¨‹ï¼Œä¸€åº§å±±è¿‡å»ååˆæ˜¯ä¸€åº§å±±ï¼Œå¯“æ„äººç”Ÿé“è·¯çš„æ›²æŠ˜ã€‚æ„è±¡åŒ…æ‹¬å±±å²­(â›°ï¸)ã€æ—…äºº(ğŸš¶)ã€å±±è·¯(ğŸï¸)å’Œéšœç¢(ğŸš§)ã€‚"
            },
            {
                text: "å‰ä¸è§å¤äººï¼Œåä¸è§æ¥è€…ã€‚\nå¿µå¤©åœ°ä¹‹æ‚ æ‚ ï¼Œç‹¬æ€†ç„¶è€Œæ¶•ä¸‹ï¼",
                source: "ç™»å¹½å·å°æ­ŒÂ·é™ˆå­æ˜‚",
                correctEmojis: [
                    { emoji: "â³", meaning: "å¤ä»Š/æ—¶é—´" },
                    { emoji: "ğŸŒ", meaning: "å¹¿é˜”/å¤©åœ°" },
                    { emoji: "ğŸ§", meaning: "å­¤ç‹¬/ç‹¬ç«‹" },
                    { emoji: "ğŸ˜¢", meaning: "æ‚²ä¼¤/æ³ªä¸‹" }
                ],
                explanation: "è¿™é¦–è¯—è¡¨è¾¾äº†è¯—äººé¢å¯¹æµ©ç€šæ—¶ç©ºçš„å­¤ç‹¬æ„Ÿå’Œå¯¹äººç”ŸçŸ­æš‚çš„æ‚²å¹ã€‚æ„è±¡åŒ…æ‹¬æ—¶é—´æµé€(â³)ã€å¤©åœ°å¹¿é˜”(ğŸŒ)ã€å­¤ç‹¬æ„Ÿ(ğŸ§)å’Œæ‚²ä¼¤æƒ…ç»ª(ğŸ˜¢)ã€‚"
            }
        ];

        // å¹²æ‰°emojiåº“
        const distractorEmojis = [
            "ğŸ˜€", "ğŸ˜", "ğŸŒˆ", "ğŸ", "ğŸ¦Š", "ğŸŒ¹", "ğŸ", "ğŸŒ»", "ğŸ¢", "ğŸŸ", 
            "ğŸ¦", "ğŸ¯", "ğŸ¦†", "â˜”", "âš¡", "â¤ï¸", "ğŸ”¥", "ğŸ­", "ğŸ¬", "ğŸ“š", 
            "â°", "ğŸ", "ğŸ†", "ğŸ®", "ğŸš—", "ğŸš‚", "âœˆï¸", "ğŸš€", "ğŸª", "ğŸï¸"
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentPoemIndex: 0,
            selectedEmojis: [],
            score: 0,
            maxCombo: 0,
            currentCombo: 0,
            startTime: null,
            totalTime: 0,
            completedPoems: 0,
            lives: 3,
            countdownTime: 20,
            countdownInterval: null,
            isPoemCompleted: false
        };

        // DOMå…ƒç´ 
        const poemTextElement = document.getElementById('poem-text');
        const poemSourceElement = document.getElementById('poem-source');
        const emojiGridElement = document.getElementById('emoji-grid');
        const explanationElement = document.getElementById('explanation');
        const explanationTextElement = document.getElementById('explanation-text');
        const generateCardButton = document.getElementById('generate-card');
        const nextPoemButton = document.getElementById('next-poem');
        const currentScoreElement = document.getElementById('current-score');
        const progressTextElement = document.getElementById('progress-text');
        const progressDotsElement = document.getElementById('progress-dots');
        const maxComboElement = document.getElementById('max-combo');
        const avgTimeElement = document.getElementById('avg-time');
        const cardModal = document.getElementById('card-modal');
        const cardPoemElement = document.getElementById('card-poem');
        const cardSourceElement = document.getElementById('card-source');
        const cardEmojisElement = document.getElementById('card-emojis');
        const cardExplanationElement = document.getElementById('card-explanation');
        const closeModalButton = document.getElementById('close-modal');
        const saveCardButton = document.getElementById('save-card');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initializeGame() {
            // éšæœºæ‰“ä¹±è¯—æ­Œé¡ºåº
            shuffleArray(poems);
            
            // åˆ›å»ºè¿›åº¦ç‚¹
            createProgressDots();
            
            // åŠ è½½ç¬¬ä¸€é¦–è¯—
            loadPoem(0);
            
            // ç¦ç”¨"ç”Ÿæˆå¡ç‰‡"æŒ‰é’®ï¼Œç›´åˆ°å®Œæˆå½“å‰è¯—çš„åŒ¹é…
            generateCardButton.disabled = true;
            
            // æ·»åŠ æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            generateCardButton.addEventListener('click', showCardModal);
            nextPoemButton.addEventListener('click', loadNextPoem);
            closeModalButton.addEventListener('click', hideCardModal);
            document.getElementById('download-wallpaper').addEventListener('click', downloadWallpaper);
            
            // è®°å½•å¼€å§‹æ—¶é—´
            gameState.startTime = new Date();
        }

        // åˆ›å»ºè¿›åº¦ç‚¹
        function createProgressDots() {
            progressDotsElement.innerHTML = '';
            for (let i = 0; i < Math.min(poems.length, 5); i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i === 0) dot.classList.add('active');
                progressDotsElement.appendChild(dot);
            }
        }

        // æ›´æ–°è¿›åº¦ç‚¹
        function updateProgressDots() {
            const dots = progressDotsElement.querySelectorAll('.progress-dot');
            const visibleDots = Math.min(poems.length, 5);
            const currentPosition = gameState.currentPoemIndex % visibleDots;
            
            dots.forEach((dot, index) => {
                dot.classList.remove('active');
                if (index === currentPosition) {
                    dot.classList.add('active');
                }
            });
        }

        // å€’è®¡æ—¶ç›¸å…³å…ƒç´ 
        const countdownTextElement = document.getElementById('countdown-text');
        const countdownBarElement = document.getElementById('countdown-bar');
        const countdownWarningElement = document.getElementById('countdown-warning');
        
        // åŠ è½½è¯—æ­Œ
        function loadPoem(index) {
            const poem = poems[index];
            
            // æ›´æ–°è¯—æ­Œæ–‡æœ¬å’Œæ¥æº
            poemTextElement.innerHTML = poem.text.replace(/\n/g, '<br>');
            poemSourceElement.textContent = poem.source;
            
            // é‡ç½®é€‰ä¸­çš„emoji
            gameState.selectedEmojis = [];
            
            // ç”Ÿæˆemojiç½‘æ ¼
            generateEmojiGrid(poem);
            
            // éšè—è§£é‡Š
            explanationElement.classList.add('hidden');
            
            // ç¦ç”¨"ç”Ÿæˆå¡ç‰‡"æŒ‰é’®
            generateCardButton.disabled = true;
            
            // å¦‚æœæ˜¯æœ€åä¸€é¦–è¯—ï¼Œç¦ç”¨"ä¸‹ä¸€é¦–"æŒ‰é’®
            nextPoemButton.disabled = index >= poems.length - 1;
            
            // æ›´æ–°è¿›åº¦
            updateProgressDots();
            
            // é‡ç½®å¹¶å¯åŠ¨å€’è®¡æ—¶
            resetCountdown();
            startCountdown();
            
            // é‡ç½®è¯—æ­Œå®ŒæˆçŠ¶æ€
            gameState.isPoemCompleted = false;
        }
        
        // å¯åŠ¨å€’è®¡æ—¶
        function startCountdown() {
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
            if (gameState.countdownInterval) {
                clearInterval(gameState.countdownInterval);
            }
            
            // é‡ç½®è®¡æ—¶å™¨çŠ¶æ€
            gameState.countdownTime = 20;
            updateCountdownDisplay();
            
            // è®¾ç½®æ–°çš„è®¡æ—¶å™¨
            gameState.countdownInterval = setInterval(() => {
                gameState.countdownTime--;
                updateCountdownDisplay();
                
                // å½“æ—¶é—´å‰©ä½™5ç§’æ—¶æ˜¾ç¤ºè­¦å‘Š
                if (gameState.countdownTime <= 5) {
                    countdownWarningElement.classList.remove('hidden');
                    countdownBarElement.classList.add('bg-red-500');
                    countdownBarElement.classList.remove('bg-primary');
                }
                
                // æ—¶é—´ç”¨å®Œ
                if (gameState.countdownTime <= 0) {
                    clearInterval(gameState.countdownInterval);
                    handleTimeUp();
                }
            }, 1000);
        }
        
        // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
        function updateCountdownDisplay() {
            // æ›´æ–°æ–‡å­—æ˜¾ç¤º
            countdownTextElement.textContent = gameState.countdownTime;
            
            // æ›´æ–°è¿›åº¦æ¡
            const percentage = (gameState.countdownTime / 20) * 100;
            countdownBarElement.style.width = `${percentage}%`;
        }
        
        // é‡ç½®å€’è®¡æ—¶æ˜¾ç¤º
        function resetCountdown() {
            gameState.countdownTime = 20;
            countdownTextElement.textContent = "20";
            countdownBarElement.style.width = "100%";
            countdownWarningElement.classList.add('hidden');
            countdownBarElement.classList.remove('bg-red-500');
            countdownBarElement.classList.add('bg-primary');
        }
        
        // å¤„ç†æ—¶é—´ç”¨å®Œ
        function handleTimeUp() {
            // å¦‚æœè¯—æ­Œå·²ç»å®Œæˆäº†ï¼Œä¸åšä»»ä½•å¤„ç†
            if (gameState.isPoemCompleted) return;
            
            // æ ¹æ®å·²åŒ¹é…çš„æ­£ç¡®emojiæ•°é‡ç»™äºˆéƒ¨åˆ†åˆ†æ•°
            const poem = poems[gameState.currentPoemIndex];
            const correctEmojis = poem.correctEmojis.map(item => item.emoji);
            const correctMatches = gameState.selectedEmojis.filter(emoji => correctEmojis.includes(emoji)).length;
            
            // æ¯ä¸ªæ­£ç¡®åŒ¹é…å¾—5åˆ†ï¼ˆè€Œä¸æ˜¯å®Œæˆå…¨éƒ¨åŒ¹é…æ—¶çš„10åˆ†/ä¸ªï¼‰
            const partialScore = correctMatches * 5;
            gameState.score += partialScore;
            
            // é‡ç½®è¿å‡»
            gameState.currentCombo = 0;
            
            // æ˜¾ç¤ºè§£é‡Šå’Œæ­£ç¡®ç­”æ¡ˆ
            explanationElement.classList.remove('hidden');
            explanationTextElement.textContent = `æ—¶é—´åˆ°ï¼ä½ åŒ¹é…äº†${correctMatches}ä¸ªæ­£ç¡®æ„è±¡ã€‚` + poem.explanation;
            
            // åœ¨ç½‘æ ¼ä¸­æ ‡è®°æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
            const emojiCards = emojiGridElement.querySelectorAll('.emoji-card');
            emojiCards.forEach(card => {
                const emoji = card.dataset.emoji;
                if (correctEmojis.includes(emoji) && !gameState.selectedEmojis.includes(emoji)) {
                    // é«˜äº®æ˜¾ç¤ºæœªé€‰ä¸­çš„æ­£ç¡®ç­”æ¡ˆ
                    card.classList.add('bg-yellow-200');
                    card.classList.add('border-2');
                    card.classList.add('border-primary');
                }
            });
            
            // å¯ç”¨"ç”Ÿæˆå¡ç‰‡"å’Œ"ä¸‹ä¸€é¦–"æŒ‰é’®
            generateCardButton.disabled = false;
            
            // æ ‡è®°å½“å‰è¯—æ­Œå·²å®Œæˆ
            gameState.isPoemCompleted = true;
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // åœæ­¢å€’è®¡æ—¶
        function stopCountdown() {
            if (gameState.countdownInterval) {
                clearInterval(gameState.countdownInterval);
                gameState.countdownInterval = null;
            }
        }

        // ç”Ÿæˆemojiç½‘æ ¼
        function generateEmojiGrid(poem) {
            emojiGridElement.innerHTML = '';
            
            // è·å–æ­£ç¡®çš„emoji
            const correctEmojis = poem.correctEmojis.map(item => item.emoji);
            
            // åˆ›å»ºåŒ…å«æ­£ç¡®emojiå’Œå¹²æ‰°emojiçš„æ•°ç»„
            const allEmojis = [...correctEmojis];
            
            // æ·»åŠ å¹²æ‰°emojiï¼Œç›´åˆ°æ€»æ•°è¾¾åˆ°12ä¸ª
            while (allEmojis.length < 12) {
                const randomIndex = Math.floor(Math.random() * distractorEmojis.length);
                const distractor = distractorEmojis[randomIndex];
                if (!allEmojis.includes(distractor)) {
                    allEmojis.push(distractor);
                }
            }
            
            // æ‰“ä¹±emojié¡ºåº
            shuffleArray(allEmojis);
            
            // åˆ›å»ºemojiå¡ç‰‡
            allEmojis.forEach(emoji => {
                const card = document.createElement('div');
                card.className = 'emoji-card bg-white shadow-md rounded-lg flex items-center justify-center p-4 cursor-pointer text-4xl';
                card.textContent = emoji;
                card.dataset.emoji = emoji;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', () => handleEmojiClick(card, emoji, poem));
                
                emojiGridElement.appendChild(card);
            });
        }

        // å¤„ç†emojiç‚¹å‡»
        function handleEmojiClick(card, emoji, poem) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»é€‰ä¸­
            if (card.classList.contains('selected')) {
                // å–æ¶ˆé€‰ä¸­
                card.classList.remove('selected');
                gameState.selectedEmojis = gameState.selectedEmojis.filter(e => e !== emoji);
            } else {
                // é€‰ä¸­
                const correctEmojis = poem.correctEmojis.map(item => item.emoji);
                
                if (correctEmojis.includes(emoji)) {
                    // æ­£ç¡®ç­”æ¡ˆ
                    card.classList.add('selected');
                    gameState.selectedEmojis.push(emoji);
                    
                    // æ·»åŠ åŠ¨ç”»
                    card.classList.add('correct-animation');
                    setTimeout(() => {
                        card.classList.remove('correct-animation');
                    }, 500);
                    
                    // æ›´æ–°åˆ†æ•°å’Œè¿å‡»
                    gameState.score += 10;
                    gameState.currentCombo++;
                    if (gameState.currentCombo > gameState.maxCombo) {
                        gameState.maxCombo = gameState.currentCombo;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆå½“å‰è¯—çš„æ‰€æœ‰æ­£ç¡®åŒ¹é…
                    if (correctEmojis.every(e => gameState.selectedEmojis.includes(e))) {
                        // åœæ­¢å€’è®¡æ—¶
                        stopCountdown();
                        
                        // æ˜¾ç¤ºè§£é‡Š
                        explanationElement.classList.remove('hidden');
                        explanationTextElement.textContent = poem.explanation;
                        
                        // å¯ç”¨"ç”Ÿæˆå¡ç‰‡"æŒ‰é’®
                        generateCardButton.disabled = false;
                        
                        // æ ‡è®°å½“å‰è¯—æ­Œå·²å®Œæˆ
                        gameState.isPoemCompleted = true;
                        
                        // è®¡ç®—é¢å¤–çš„æ—¶é—´å¥–åŠ±ï¼ˆå‰©ä½™æ—¶é—´ Ã— 2ï¼‰
                        const timeBonus = gameState.countdownTime * 2;
                        gameState.score += timeBonus;
                        
                        // æ›´æ–°è§£é‡Šæ–‡æœ¬ï¼ŒåŒ…å«æ—¶é—´å¥–åŠ±ä¿¡æ¯
                        explanationTextElement.textContent = `å¤ªæ£’äº†ï¼ä½ æˆåŠŸåŒ¹é…äº†æ‰€æœ‰æ„è±¡ï¼Œè·å¾—æ—¶é—´å¥–åŠ± ${timeBonus} åˆ†ï¼\n` + poem.explanation;
                    }
                } else {
                    // é”™è¯¯ç­”æ¡ˆ
                    gameState.currentCombo = 0;
                    gameState.lives--;
                    
                    // å¡ç‰‡çŸ­æš‚é—ªçƒ
                    card.classList.add('bg-red-200');
                    setTimeout(() => {
                        card.classList.remove('bg-red-200');
                    }, 300);
                    
                    // å¦‚æœæ²¡æœ‰ç”Ÿå‘½å€¼ï¼Œæ¸¸æˆç»“æŸ
                    if (gameState.lives <= 0) {
                        endGame();
                    }
                }
                
                // æ›´æ–°UI
                updateUI();
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            currentScoreElement.textContent = `å¾—åˆ†ï¼š${gameState.score}`;
            progressTextElement.textContent = `å‰©ä½™æœºä¼šï¼š${gameState.lives}`;
            maxComboElement.textContent = gameState.maxCombo;
            
            if (gameState.completedPoems > 0) {
                const avgTimeInSeconds = Math.round(gameState.totalTime / gameState.completedPoems);
                avgTimeElement.textContent = `${avgTimeInSeconds}s`;
            }
        }

        // åŠ è½½ä¸‹ä¸€é¦–è¯—
        function loadNextPoem() {
            // åœæ­¢å½“å‰å€’è®¡æ—¶
            stopCountdown();
            
            // è®°å½•å®Œæˆæ—¶é—´
            const now = new Date();
            const timeTaken = (now - gameState.startTime) / 1000; // ç§’
            gameState.totalTime += timeTaken;
            gameState.completedPoems++;
            
            // é‡ç½®å¼€å§‹æ—¶é—´
            gameState.startTime = now;
            
            // å‰è¿›åˆ°ä¸‹ä¸€é¦–è¯—
            gameState.currentPoemIndex++;
            
            if (gameState.currentPoemIndex < poems.length) {
                loadPoem(gameState.currentPoemIndex);
            } else {
                // æ¸¸æˆç»“æŸ
                endGame();
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            if (gameState.lives <= 0) {
                alert(`æ¸¸æˆç»“æŸï¼\n\nä½ çš„æœ€ç»ˆå¾—åˆ†æ˜¯ï¼š${gameState.score}\næœ€é«˜è¿å‡»ï¼š${gameState.maxCombo}`);
            } else {
                alert(`æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰è¯—æ­Œçš„é…å¯¹ï¼\n\næœ€ç»ˆå¾—åˆ†ï¼š${gameState.score}\næœ€é«˜è¿å‡»ï¼š${gameState.maxCombo}`);
            }
            
            // é‡æ–°å¼€å§‹æ¸¸æˆ
            resetGame();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // åœæ­¢ä»»ä½•æ­£åœ¨è¿è¡Œçš„å€’è®¡æ—¶
            stopCountdown();
            
            gameState = {
                currentPoemIndex: 0,
                selectedEmojis: [],
                score: 0,
                maxCombo: 0,
                currentCombo: 0,
                startTime: new Date(),
                totalTime: 0,
                completedPoems: 0,
                lives: 3,
                countdownTime: 20,
                countdownInterval: null,
                isPoemCompleted: false
            };
            
            shuffleArray(poems);
            createProgressDots();
            loadPoem(0);
            updateUI();
        }

        // å£çº¸åˆ¶ä½œç›¸å…³å˜é‡
        let currentWallpaperStyle = 'classic';
        
        // æ˜¾ç¤ºå£çº¸åˆ¶ä½œæ¨¡æ€æ¡†
        function showCardModal() {
            const poem = poems[gameState.currentPoemIndex];
            
            // æ›´æ–°é¢„è§ˆå†…å®¹
            updateWallpaperPreview(poem);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            cardModal.classList.remove('hidden');
            
            // åˆå§‹åŒ–é£æ ¼é€‰æ‹©å™¨
            initializeStyleSelector();
        }

        // åˆå§‹åŒ–é£æ ¼é€‰æ‹©å™¨
        function initializeStyleSelector() {
            const styleButtons = document.querySelectorAll('.style-btn');
            
            styleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeæ ·å¼
                    styleButtons.forEach(btn => btn.classList.remove('ring-2', 'ring-primary'));
                    
                    // æ·»åŠ activeæ ·å¼åˆ°å½“å‰æŒ‰é’®
                    button.classList.add('ring-2', 'ring-primary');
                    
                    // æ›´æ–°å½“å‰é£æ ¼
                    currentWallpaperStyle = button.dataset.style;
                    
                    // æ›´æ–°é¢„è§ˆ
                    const poem = poems[gameState.currentPoemIndex];
                    updateWallpaperPreview(poem);
                });
            });
            
            // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªé£æ ¼
            if (styleButtons.length > 0) {
                styleButtons[0].classList.add('ring-2', 'ring-primary');
            }
        }

        // æ›´æ–°å£çº¸é¢„è§ˆ
        function updateWallpaperPreview(poem) {
            const wallpaperContent = document.getElementById('wallpaper-content');
            const previewPoem = document.getElementById('preview-poem');
            const previewSource = document.getElementById('preview-source');
            const previewEmojis = document.getElementById('preview-emojis');
            
            // æ›´æ–°é£æ ¼ç±» - 9:16æ¯”ä¾‹çš„å¸ƒå±€
            wallpaperContent.className = `card-style-${currentWallpaperStyle} w-full h-full relative p-4 flex flex-col justify-center`;
            
            // æ ¼å¼åŒ–è¯—æ­Œæ–‡æœ¬ - å¤ç±æ–¹å¼ç”±å³è‡³å·¦ç«–æ’ç‰ˆï¼Œæ¯å¥è¯—ä¸€åˆ—
            const poemLines = poem.text.split('\n');
            
            previewPoem.innerHTML = `
                <div class="flex justify-center items-center h-full">
                    <!-- å¤ç±å¼æ’ç‰ˆï¼šä»å³åˆ°å·¦ -->
                    <div class="flex items-center space-x-2" style="flex-direction: row-reverse;">
                        ${poemLines.map(line => `
                            <div class="flex flex-col text-center" style="writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 0.05em; font-family: 'STXingkai', 'STKaiti', 'KaiTi', 'SimKai', serif;">
                                ${line.split('').map(char => `<span class="block text-xs leading-tight">${char}</span>`).join('')}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // è®¾ç½®ä½œè€…ä¿¡æ¯ä¸ºç«–æ’ï¼ˆå°†æ”¾åœ¨å·¦ä¸‹è§’ï¼‰
            const [title, author] = poem.source.split('Â·');
            previewSource.innerHTML = `
                <div class="flex space-x-1" style="flex-direction: row-reverse;">
                    <div class="flex flex-col text-center" style="writing-mode: vertical-rl; text-orientation: upright; font-family: 'STXingkai', 'STKaiti', 'KaiTi', 'SimKai', serif;">
                        ${author ? author.split('').map(char => `<span class="block text-xs">${char}</span>`).join('') : ''}
                    </div>
                    <div class="flex flex-col text-center" style="writing-mode: vertical-rl; text-orientation: upright; font-family: 'STXingkai', 'STKaiti', 'KaiTi', 'SimKai', serif;">
                        ${title.split('').map(char => `<span class="block text-xs">${char}</span>`).join('')}
                    </div>
                </div>
            `;
            
            // éšè—emojiæ„è±¡ï¼ˆä¸åœ¨å£çº¸ä¸­æ˜¾ç¤ºï¼‰
            previewEmojis.innerHTML = '';
            previewEmojis.style.display = 'none';
        }

        // éšè—å£çº¸æ¨¡æ€æ¡†
        function hideCardModal() {
            cardModal.classList.add('hidden');
        }

        // ä¸‹è½½å£çº¸
        async function downloadWallpaper() {
            const poem = poems[gameState.currentPoemIndex];
            
            // æ˜¾ç¤ºä¸‹è½½æç¤º
            const downloadBtn = document.getElementById('download-wallpaper');
            const originalText = downloadBtn.textContent;
            downloadBtn.textContent = 'æ­£åœ¨ç”Ÿæˆ...';
            downloadBtn.disabled = true;
            
            try {
                // åˆ›å»ºé«˜åˆ†è¾¨ç‡çš„å£çº¸å®¹å™¨ - 9:16æ¯”ä¾‹ï¼ˆæ‰‹æœºå£çº¸ï¼‰
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // è®¾ç½®canvaså°ºå¯¸ (1080x1920, 9:16æ¯”ä¾‹)
                canvas.width = 1080;
                canvas.height = 1920;
                
                // è·å–å½“å‰é£æ ¼çš„é¢œè‰²é…ç½®
                const styleConfig = {
                    'classic': { bg: ['#f4f1e8', '#e8dcc0'], color: '#8B4513', border: '#8B4513' },
                    'ink': { bg: ['#f8f8f8', '#e0e0e0'], color: '#333', border: '#333' },
                    'elegant': { bg: ['#fff', '#f0f8ff'], color: '#4682b4', border: '#4682b4' },
                    'sunset': { bg: ['#ffe4e1', '#ffd4c4'], color: '#cd853f', border: '#cd853f' },
                    'bamboo': { bg: ['#f0fff0', '#e6ffe6'], color: '#228b22', border: '#228b22' },
                    'dark': { bg: ['#2c2c2c', '#1a1a1a'], color: '#f0f0f0', border: '#8b7355' }
                };
                
                const config = styleConfig[currentWallpaperStyle];
                
                // åˆ›å»ºæ¸å˜èƒŒæ™¯
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, config.bg[0]);
                gradient.addColorStop(1, config.bg[1]);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶è£…é¥°è¾¹æ¡†
                ctx.strokeStyle = config.border;
                ctx.lineWidth = 8;
                const borderSize = 80;
                const margin = 40;
                
                // å››ä¸ªè§’çš„è£…é¥°è¾¹æ¡†
                ctx.beginPath();
                // å·¦ä¸Šè§’
                ctx.moveTo(margin, margin + borderSize);
                ctx.lineTo(margin, margin);
                ctx.lineTo(margin + borderSize, margin);
                // å³ä¸Šè§’
                ctx.moveTo(canvas.width - margin - borderSize, margin);
                ctx.lineTo(canvas.width - margin, margin);
                ctx.lineTo(canvas.width - margin, margin + borderSize);
                // å·¦ä¸‹è§’
                ctx.moveTo(margin, canvas.height - margin - borderSize);
                ctx.lineTo(margin, canvas.height - margin);
                ctx.lineTo(margin + borderSize, canvas.height - margin);
                // å³ä¸‹è§’
                ctx.moveTo(canvas.width - margin - borderSize, canvas.height - margin);
                ctx.lineTo(canvas.width - margin, canvas.height - margin);
                ctx.lineTo(canvas.width - margin, canvas.height - margin - borderSize);
                ctx.stroke();
                
                // è®¾ç½®å­—ä½“æ ·å¼ï¼ˆè¡Œä¹¦é£æ ¼ï¼‰
                ctx.fillStyle = config.color;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // å¤ç±å¼æ’ç‰ˆï¼šæ¯å¥è¯—ä¸€åˆ—ï¼Œç”±å³è‡³å·¦æ’åˆ—
                const poemLines = poem.text.split('\n');
                
                // å­—ä½“å¤§å°å’Œä½ç½®è®¾ç½®
                const fontSize = 80;
                const charSpacing = fontSize + 20;
                const columnSpacing = 150; // åˆ—é—´è·
                const startY = 200; // è°ƒæ•´åˆ°å³ä¸Šè§’ä½ç½®
                
                // è®¡ç®—æ€»å®½åº¦å¹¶ç¡®å®šèµ·å§‹ä½ç½®ï¼ˆå³ä¾§å¼€å§‹ï¼‰
                const totalWidth = (poemLines.length - 1) * columnSpacing;
                const startX = canvas.width - 180; // ä»å³ä¾§å¼€å§‹ï¼Œä¸è¾¹æ¡†ä¿æŒåˆé€‚è·ç¦»
                
                // ä»å³åˆ°å·¦ç»˜åˆ¶æ¯å¥è¯—ï¼ˆå¤ç±é˜…è¯»é¡ºåºï¼‰
                poemLines.forEach((line, lineIndex) => {
                    const chars = line.split('');
                    const currentX = startX - lineIndex * columnSpacing;
                    
                    // è®¡ç®—æ¯åˆ—çš„èµ·å§‹Yä½ç½®ï¼ˆä»ä¸Šå¼€å§‹ï¼‰
                    const lineStartY = startY;
                    
                    chars.forEach((char, charIndex) => {
                        ctx.font = `${fontSize}px "STXingkai", "STKaiti", "KaiTi", "SimKai", serif`;
                        // ä»ä¸Šè‡³ä¸‹æ’åˆ—ï¼šYåæ ‡é€’å¢
                        ctx.fillText(char, currentX, lineStartY + charIndex * charSpacing);
                    });
                });
                
                // åœ¨å·¦ä¸‹è§’ç»˜åˆ¶è¯—åå’Œä½œè€…ä¿¡æ¯ï¼ˆç«–æ’ï¼‰
                const [title, author] = poem.source.split('Â·');
                
                // åŠ¨æ€è®¡ç®—å¸ƒå±€ä½ç½®ï¼Œé¿å…é®æŒ¡
                const titleChars = title.split('');
                const authorChars = author ? author.split('') : [];
                
                // å­—ç¬¦é—´è·
                const titleCharSpacing = 55;
                const authorCharSpacing = 50;
                
                // è®¡ç®—æ‰€éœ€é«˜åº¦
                const titleHeight = titleChars.length * titleCharSpacing;
                const authorHeight = authorChars.length * authorCharSpacing;
                const maxTextHeight = Math.max(titleHeight, authorHeight);
                
                // logoé«˜åº¦å’Œé—´è·
                const logoHeight = 60;
                const textToLogoGap = 40; // æ–‡å­—åˆ°logoçš„é—´è·
                const logoBottomMargin = 80; // logoåˆ°åº•éƒ¨çš„è¾¹è·
                
                // è®¡ç®—èµ·å§‹ä½ç½®ï¼ˆä»åº•éƒ¨å¾€ä¸Šè®¡ç®—ï¼‰
                const logoY = canvas.height - logoBottomMargin;
                const textBottomY = logoY - logoHeight/2 - textToLogoGap;
                const textStartY = textBottomY - maxTextHeight;
                
                // ç¡®ä¿æ–‡å­—ä¸ä¼šè¶…å‡ºé¡¶éƒ¨è¾¹ç•Œ
                const minTextStartY = 200; // æœ€å°èµ·å§‹ä½ç½®
                const finalTextStartY = Math.max(textStartY, minTextStartY);
                
                // ç»˜åˆ¶ä½œè€…ï¼ˆæœ€å·¦ä¾§ï¼Œä»ä¸Šåˆ°ä¸‹ï¼‰
                if (author) {
                    const authorX = 120;
                    const authorStartY = finalTextStartY;
                    
                    ctx.font = '40px "STXingkai", "STKaiti", "KaiTi", "SimKai", serif';
                    authorChars.forEach((char, charIndex) => {
                        ctx.fillText(char, authorX, authorStartY + charIndex * authorCharSpacing);
                    });
                }
                
                // ç»˜åˆ¶è¯—åï¼ˆä½œè€…å³ä¾§ï¼Œä»ä¸Šåˆ°ä¸‹ï¼‰
                const titleX = 200;
                const titleStartY = finalTextStartY;
                
                ctx.font = '45px "STXingkai", "STKaiti", "KaiTi", "SimKai", serif';
                titleChars.forEach((char, charIndex) => {
                    ctx.fillText(char, titleX, titleStartY + charIndex * titleCharSpacing);
                });
                
                // åœ¨å·¦ä¸‹è§’ç»˜åˆ¶å“ç‰Œæ ‡è¯†ï¼ˆå°ç« æ•ˆæœï¼‰
                const logoX = 160; // ä½äºä½œè€…å’Œè¯—åä¸­é—´åå³
                
                ctx.fillStyle = '#b91c1c';
                ctx.fillRect(logoX - 60, logoY - 30, 120, 60);
                ctx.fillStyle = 'white';
                ctx.font = '24px "STKaiti", "KaiTi", "SimKai", serif';
                ctx.textAlign = 'center';
                ctx.fillText('æ„emoji', logoX, logoY);
                
                // è½¬æ¢ä¸ºblobå¹¶ä¸‹è½½
                canvas.toBlob(blob => {
                    if (blob) {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `æ„emoji-${poem.source.replace(/[Â·\s]/g, '-')}-9x16.jpg`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                        
                        alert('å£çº¸ä¸‹è½½æˆåŠŸï¼');
                    } else {
                        throw new Error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥');
                    }
                }, 'image/jpeg', 0.9);
                
            } catch (error) {
                console.error('ç”Ÿæˆå£çº¸å¤±è´¥:', error);
                alert('ç”Ÿæˆå£çº¸å¤±è´¥ï¼Œè¯·é‡è¯•\né”™è¯¯ä¿¡æ¯ï¼š' + error.message);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            }
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initializeGame();
    </script>


</body></html>